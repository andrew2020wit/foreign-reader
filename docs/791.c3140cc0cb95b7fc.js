"use strict";(self.webpackChunkforeign_reader=self.webpackChunkforeign_reader||[]).push([[791],{1177:(D,E,s)=>{s.d(E,{LH:()=>C,Ot:()=>t,Zt:()=>v,jk:()=>n});const n="http://127.0.0.1:8765",t=500,C="ankiTag",v="ankiRequestText"},9791:(D,E,s)=>{s.d(E,{G:()=>M});var n=s(1635),t=s(4438),C=s(5256),v=s(8834),h=s(9213),O=s(9417),r=s(850),_=s(882),f=s(9631),y=s(6600),d=s(3716),m=s(6697),l=s(6354),p=s(1177),g=s(280),S=s(3609),W=s(7251),w=s(242),B=s(9530),b=s(16);const A=["topMarker"];function I(c,i){if(1&c){const e=t.RV6();t.j41(0,"mat-option",14),t.bIt("keyup.enter",function(){const a=t.eBV(e).$implicit,u=t.XpG();return t.Njj(u.selectTermOption(a))})("click",function(){const a=t.eBV(e).$implicit,u=t.XpG();return t.Njj(u.selectTermOption(a))}),t.EFF(1),t.k0s()}if(2&c){const e=i.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function L(c,i){1&c&&(t.j41(0,"div",8),t.EFF(1," dictionaryIsEmpty "),t.k0s())}function j(c,i){if(1&c){const e=t.RV6();t.j41(0,"div",16),t.bIt("click",function(){const a=t.eBV(e).$implicit,u=t.XpG(2);return t.Njj(u.selectPartOfSpeech(a))}),t.EFF(1),t.k0s()}if(2&c){const e=i.$implicit,o=t.XpG(2);t.AVh("selected",o.selectedPartsOfSpeech.includes(e)),t.R7$(),t.SpI(" ",e," ")}}function U(c,i){if(1&c&&(t.j41(0,"div",9),t.Z7z(1,j,2,3,"div",15,t.fX1),t.k0s()),2&c){const e=t.XpG();t.R7$(),t.Dyx(e.partsOfSpeech)}}function K(c,i){if(1&c){const e=t.RV6();t.j41(0,"button",17),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.favoriteWordsService.switchCurrent())}),t.j41(1,"mat-icon"),t.EFF(2,"star"),t.k0s()()}if(2&c){const e=t.XpG();t.Y8G("color",null!=e.favoriteWordStatus&&e.favoriteWordStatus.status?"accent":"primary")}}function $(c,i){1&c&&t.EFF(0," => ")}function V(c,i){if(1&c&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,$,1,0),t.k0s()),2&c){const e=t.XpG();t.R7$(),t.SpI(" ",e.searchTerm," "),t.R7$(),t.vxM(2,null!=e.dictionaryTerm&&e.dictionaryTerm.term?2:-1)}}function N(c,i){if(1&c&&(t.j41(0,"span",19),t.EFF(1),t.k0s()),2&c){const e=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",e.transcription," ")}}function X(c,i){if(1&c&&(t.j41(0,"span",20),t.EFF(1),t.k0s()),2&c){const e=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",e.dictionaryName," ")}}function H(c,i){if(1&c&&(t.j41(0,"div",23),t.EFF(1),t.k0s()),2&c){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.lexicalUnit," ")}}function G(c,i){if(1&c&&(t.j41(0,"span",26),t.EFF(1),t.k0s()),2&c){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.level)}}function k(c,i){1&c&&(t.j41(0,"span",27),t.nrm(1,"div",33),t.k0s())}function Y(c,i){1&c&&(t.j41(0,"span",28),t.nrm(1,"div",33),t.k0s())}function z(c,i){if(1&c&&(t.j41(0,"div",30),t.EFF(1),t.k0s()),2&c){const e=t.XpG().$implicit;t.R7$(),t.SpI(" Synonym: ",e.synonym," ")}}function et(c,i){if(1&c&&(t.j41(0,"div",31),t.EFF(1),t.k0s()),2&c){const e=t.XpG().$implicit;t.R7$(),t.SpI(" Antonym: ",e.antonym," ")}}function Q(c,i){if(1&c){const e=t.RV6();t.j41(0,"div",35)(1,"div",36),t.bIt("dblclick",function(){t.eBV(e);const a=t.XpG(5);return t.Njj(a.clickOnWord())}),t.j41(2,"button",37),t.bIt("click",function(a){const u=t.eBV(e).$implicit,P=t.XpG(2).$implicit,R=t.XpG(2).$implicit;return t.XpG().addExample(u,P,R),t.Njj(a.stopPropagation())}),t.nrm(3,"mat-icon",38),t.k0s(),t.j41(4,"span"),t.EFF(5),t.k0s()(),t.j41(6,"div",39),t.EFF(7),t.k0s()()}if(2&c){const e=i.$implicit;t.R7$(2),t.Y8G("color",e.externalId?"accent":"primary"),t.R7$(3),t.SpI(" ",e.original," "),t.R7$(2),t.JRh(e.translation)}}function it(c,i){if(1&c&&(t.j41(0,"div",32)(1,"div",34),t.Z7z(2,Q,8,3,"div",35,t.fX1),t.k0s()()),2&c){const e=t.XpG().$implicit;t.R7$(2),t.Dyx(e.examples)}}function x(c,i){if(1&c){const e=t.RV6();t.j41(0,"div",22),t.DNE(1,H,2,1,"div",23),t.j41(2,"div",24),t.bIt("click",function(){const a=t.eBV(e).$implicit;return t.Njj(a.showDetails=!a.showDetails)}),t.j41(3,"span",25),t.bIt("dblclick",function(){t.eBV(e);const a=t.XpG(3);return t.Njj(a.clickOnWord())}),t.DNE(4,G,2,1,"span",26)(5,k,2,0,"span",27)(6,Y,2,0,"span",28),t.j41(7,"span",29),t.EFF(8),t.k0s()()(),t.DNE(9,z,2,1,"div",30)(10,et,2,1,"div",31)(11,it,4,0,"div",32),t.k0s()}if(2&c){const e=i.$implicit;t.R7$(),t.vxM(1,e.lexicalUnit?1:-1),t.R7$(),t.AVh("has-examples",e.examples),t.R7$(2),t.vxM(4,e.level?4:-1),t.R7$(),t.vxM(5,e.examples?5:-1),t.R7$(),t.vxM(6,e.examples?-1:6),t.R7$(2),t.SpI(" ",e.definition," "),t.R7$(),t.vxM(9,e.synonym?9:-1),t.R7$(),t.vxM(10,e.antonym?10:-1),t.R7$(),t.vxM(11,e.showDetails?11:-1)}}function J(c,i){if(1&c){const e=t.RV6();t.j41(0,"div",18),t.DNE(1,N,2,1,"span",19),t.j41(2,"span",16),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,u=t.XpG();return t.Njj(u.selectPartOfSpeech(a.partOfSpeech))}),t.EFF(3),t.k0s(),t.DNE(4,X,2,1,"span",20),t.k0s(),t.j41(5,"div",21),t.Z7z(6,x,12,10,"div",22,t.fX1),t.k0s()}if(2&c){const e=t.XpG().$implicit,o=t.XpG();t.R7$(),t.vxM(1,e.transcription?1:-1),t.R7$(),t.AVh("selected",o.selectedPartsOfSpeech.includes(e.partOfSpeech)),t.R7$(),t.SpI(" ",e.partOfSpeech," "),t.R7$(),t.vxM(4,e.dictionaryName?4:-1),t.R7$(2),t.Dyx(e.definitions)}}function Z(c,i){if(1&c&&(t.j41(0,"div",12),t.DNE(1,J,8,5),t.k0s()),2&c){const e=i.$implicit,o=t.XpG();t.R7$(),t.vxM(1,!o.selectedPartsOfSpeech.length||o.selectedPartsOfSpeech.includes(e.partOfSpeech)?1:-1)}}function F(c,i){if(1&c){const e=t.RV6();t.j41(0,"div",42),t.bIt("dblclick",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.clickOnWord())}),t.EFF(1),t.k0s()}if(2&c){const e=i.$implicit;t.R7$(),t.SpI(" ",e," ")}}function q(c,i){if(1&c&&(t.j41(0,"div",13)(1,"div",40),t.EFF(2,"See also:"),t.k0s(),t.Z7z(3,F,2,1,"div",41,t.fX1),t.k0s()),2&c){const e=t.XpG();t.R7$(3),t.Dyx(e.words)}}let M=class tt{set term(i){this.dictionaryService.setTerm(i),this.searchControl.setValue(i,{emitEvent:!1})}constructor(i,e,o,a,u,P,R){this.favoriteWordsService=i,this.cdr=e,this.dictionaryService=o,this.favoriteExamplesService=a,this.localStorageService=u,this.info=P,this.ankiConnectService=R,this.newTermIsSet=new t.bkB,this.searchTerm="",this.dictionaryIsEmpty=!1,this.dictionaryTerm=null,this.partsOfSpeech=[],this.selectedPartsOfSpeech=[],this.words=[],this.termOptions=[],this.searchControl=new O.MJ(""),this.favoriteWordStatus=null,this.useExternalId=this.localStorageService.useExternalId,this.tag=localStorage.getItem(p.LH)||"selected",this.ankiDeck=this.localStorageService.ankiDeck}selectPartOfSpeech(i){this.selectedPartsOfSpeech.includes(i)?this.selectedPartsOfSpeech=this.selectedPartsOfSpeech.filter(e=>e!==i):this.selectedPartsOfSpeech.push(i)}ngOnInit(){this.favoriteWordsService.check$.pipe((0,C.s)(this)).subscribe(i=>{this.favoriteWordStatus=i,this.cdr.detectChanges()}),this.dictionaryService.currentDictionaryState$.pipe((0,C.s)(this)).subscribe(i=>{this.searchTerm=i?.searchTerm||"",this.dictionaryTerm=i?.currentDictionaryTerm||null,this.dictionaryIsEmpty=!!i?.dictionaryIsEmpty,this.words=i?.seeAlsoWords||[],this.dictionaryTerm?.term&&(this.words=this.words.filter(e=>e!==this.dictionaryTerm?.term)),this.setTerm(this.dictionaryTerm)}),this.initSearchControl()}initSearchControl(){this.searchControl.valueChanges.subscribe(i=>{!i||i.length<this.dictionaryService.minimalSearchPattern?this.termOptions=[]:(this.termOptions=this.dictionaryService.searchTerms(i)||[],1===this.termOptions.length&&this.selectTermOption(this.termOptions[0]))})}paste(){navigator.clipboard.readText().then(i=>this.selectTermOption(i?.trim()||""),i=>console.error(i))}selectTermOption(i){this.dictionaryService.setTerm(i||""),this.termOptions=[],this.newTermIsSet.emit(i||"")}clickOnWord(){const i=(0,d.T)();this.searchControl.setValue(i,{emitEvent:!1}),this.dictionaryService.setTerm(i),this.newTermIsSet.emit(i)}markForAnki(i){const e=i.externalId;e&&this.ankiConnectService.findCards("id:"+e).pipe((0,m.s)(1),(0,l.T)(a=>a.slice(0,p.Ot))).subscribe(a=>{this.ankiConnectService.markCards(a.map(u=>u.cardId))})}addExample(i,e,o){this.useExternalId&&i.externalId?this.markForAnki(i):this.favoriteExamplesService.addExample({definition:e.definition,original:i.original,translation:i.translation||"",synonym:e.synonym||"",antonym:e.antonym||"",level:e.level||"",partOfSpeech:o.partOfSpeech,term:this.dictionaryTerm?.term||"",transcription:o.transcription||""})}setTerm(i){if(this.selectedPartsOfSpeech=[],this.dictionaryTerm=i,!i)return this.partsOfSpeech=[],void this.cdr.detectChanges();const e=i.articles.map(o=>o.partOfSpeech?.toLowerCase()?.trim()||"").filter(o=>!!o);this.partsOfSpeech=[...new Set(e)],this.topMarker?.nativeElement?.scrollIntoView(),this.cdr.detectChanges()}static{this.\u0275fac=function(e){return new(e||tt)(t.rXU(g.b),t.rXU(t.gRc),t.rXU(S.K),t.rXU(W.f),t.rXU(w.s),t.rXU(B.O),t.rXU(b.b))}}static{this.\u0275cmp=t.VBU({type:tt,selectors:[["app-dictionary-widget"]],viewQuery:function(e,o){if(1&e&&t.GBs(A,5),2&e){let a;t.mGM(a=t.lsd())&&(o.topMarker=a.first)}},inputs:{term:"term"},outputs:{newTermIsSet:"newTermIsSet"},standalone:!0,features:[t.aNF],decls:21,vars:8,consts:[["topMarker",""],["auto","matAutocomplete"],[1,"top-marker"],[1,"search-bar"],[1,"form-field"],[1,"mat-label"],["type","text","placeholder","Term","autocomplete","false","matInput","",3,"keyup.enter","keyup","keydown","paste","formControl","matAutocomplete"],[3,"value"],[1,"empty-dictionary"],[1,"parts-of-speech"],[1,"header"],["mat-icon-button","",1,"favorite-word-button",3,"color"],[1,"article"],[1,"words"],[3,"keyup.enter","click","value"],[1,"part-of-speech",3,"selected"],[1,"part-of-speech",3,"click"],["mat-icon-button","",1,"favorite-word-button",3,"click","color"],[1,"article-header"],[1,"transcription"],[1,"dictionary"],[1,"definitions"],[1,"definition"],[1,"lex-unit"],[1,"definition",3,"click"],[3,"dblclick"],[1,"level"],[1,"content-mark"],[1,"non-content-mark"],[1,"def-text"],[1,"synonym"],[1,"antonym"],[1,"details"],[1,"box"],[1,"examples"],[1,"example"],[1,"original",3,"dblclick"],["mat-icon-button","",3,"click","color"],["fontIcon","add",1,"icon"],[1,"translation"],[1,"title"],[1,"word"],[1,"word",3,"dblclick"]],template:function(e,o){if(1&e){const a=t.RV6();t.nrm(0,"div",2,0),t.j41(2,"div",3)(3,"mat-form-field",4)(4,"mat-label",5),t.EFF(5,"Term"),t.k0s(),t.j41(6,"input",6),t.bIt("keyup.enter",function(){return t.eBV(a),t.Njj(o.selectTermOption(o.searchControl.value))})("keyup",function(P){return t.eBV(a),t.Njj(P.stopPropagation())})("keydown",function(P){return t.eBV(a),t.Njj(P.stopPropagation())})("paste",function(){return t.eBV(a),t.Njj(o.paste())}),t.k0s(),t.j41(7,"mat-autocomplete",null,1),t.Z7z(9,I,2,2,"mat-option",7,t.fX1),t.k0s()()(),t.DNE(11,L,2,0,"div",8)(12,U,3,0,"div",9),t.j41(13,"div",10),t.DNE(14,K,3,1,"button",11)(15,V,3,2,"span"),t.j41(16,"span"),t.EFF(17),t.k0s()(),t.Z7z(18,Z,2,1,"div",12,t.fX1),t.DNE(20,q,5,0,"div",13)}if(2&e){let a;const u=t.sdS(8);t.R7$(6),t.Y8G("formControl",o.searchControl)("matAutocomplete",u),t.R7$(3),t.Dyx(o.termOptions),t.R7$(2),t.vxM(11,o.dictionaryIsEmpty?11:-1),t.R7$(),t.vxM(12,null!=o.partsOfSpeech&&o.partsOfSpeech.length&&o.partsOfSpeech.length>1?12:-1),t.R7$(2),t.vxM(14,null!=o.dictionaryTerm&&o.dictionaryTerm.term?14:-1),t.R7$(),t.vxM(15,o.searchTerm.trim().toLowerCase()!==(null==o.dictionaryTerm||null==o.dictionaryTerm.term||null==(a=o.dictionaryTerm.term.trim())?null:a.toLowerCase())?15:-1),t.R7$(2),t.SpI(" ",null==o.dictionaryTerm?null:o.dictionaryTerm.term," "),t.R7$(),t.Dyx(null==o.dictionaryTerm?null:o.dictionaryTerm.articles),t.R7$(2),t.vxM(20,o.words.length?20:-1)}},dependencies:[v.Hl,v.iY,h.m_,h.An,O.YN,O.me,O.BC,r.jL,r.$3,y.wT,r.pN,_.RG,_.rl,_.nJ,f.fS,f.fg,y.Sy,O.X1,O.l_],styles:["[_nghost-%COMP%]{display:block;padding:var(--padding-main);font-size:var(--dictionary-main-font-size)}.parts-of-speech[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.parts-of-speech[_ngcontent-%COMP%]   .part-of-speech[_ngcontent-%COMP%]{cursor:pointer;margin:4px}.parts-of-speech[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{outline:1px solid green}.header[_ngcontent-%COMP%]{font-size:var(--dictionary-header-font-size);font-weight:700;display:flex;flex-wrap:wrap;align-items:center;gap:8px}.header[_ngcontent-%COMP%]   .favorite-word-button[_ngcontent-%COMP%]{padding:8px 0 0;margin-right:-8px}.header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1}.has-examples[_ngcontent-%COMP%]   .def-text[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]{margin:16px 0}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]{margin:var(--padding-main) 0;line-height:2}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#f9e79f}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .dictionary[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#94ff7d}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]{margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;background-color:wheat;height:12px;width:12px;transform:translateY(-2px)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{height:8px;width:8px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{background-color:green}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .lex-unit[_ngcontent-%COMP%]{font-weight:700;font-size:1.2em;background-color:wheat;color:#000;padding:2px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .level[_ngcontent-%COMP%]{color:green;font-weight:700;background-color:wheat;padding:2px;margin-right:4px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .synonym[_ngcontent-%COMP%]{color:green;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .antonym[_ngcontent-%COMP%]{color:red;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]{padding-left:var(--padding-small);margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]{display:flex;align-items:center}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:gray;padding-left:var(--padding-large)}.part-of-speech[_ngcontent-%COMP%]{font-weight:700;background-color:wheat;color:#000;padding:4px;margin:4px 0;cursor:pointer}.words[_ngcontent-%COMP%]{display:flex;gap:8px}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:center;gap:var(--padding-main);width:100%}.form-field[_ngcontent-%COMP%]{width:800px;max-width:90vw}.mat-label[_ngcontent-%COMP%]{color:gray!important}"],changeDetection:0})}};M=(0,n.Cg)([(0,C.d)()],M)},3609:(D,E,s)=>{s.d(E,{K:()=>r});var n=s(4412),t=s(4572),C=s(6697);function v(_,f){const y=f.index>=0?f.index:_.length+f.index;if(_.slice(y,y+f.pattern.length)!==f.pattern)return null;const d=_.length-(_.slice(0,f.index).length+f.pattern.length);let m=_.slice(0,f.index)+f.replace;return d>0&&(m+=_.slice(-1*d)),m}var h=s(4438),O=s(7915);let r=(()=>{class _{constructor(y){this.bookService=y,this.currentDictionaryState$=new n.t(null),this.minimalSearchPattern=2,this.maxNumberOfSearchResults=50,this.morphology={},this.morphologyReplaceRules=[],this.dictionaryIsEmpty=!0,this.morphologyIsEmpty=!0,this.searchTerm="",this.currentTerm="",this.terms=[],this.seeAlsoWords=[],(0,t.z)([this.bookService.getMorphology$(),this.bookService.getDictionaryTerms$(),this.bookService.getMorphologyReplaceRules$()]).pipe((0,C.s)(1)).subscribe(([d,m,l])=>{d?.morphology?(this.morphology=d.morphology,this.morphologyIsEmpty=!1):(this.morphology={},this.morphologyIsEmpty=!0),this.morphologyReplaceRules=l?.morphologyReplaceRules?l.morphologyReplaceRules:[],m.length?(this.terms=m,this.dictionaryIsEmpty=!1):this.dictionaryIsEmpty=!0,this.setDictionaryState(null),this.searchTerm&&this.setTerm(this.searchTerm)})}searchTerms(y){if(y.length<this.minimalSearchPattern)return null;const d=new RegExp(y.replaceAll("*",".+"),"iu");return this.terms.filter(m=>d.test(m)).slice(0,this.maxNumberOfSearchResults)}setTerm(y){if(this.searchTerm=y,this.currentTerm=y.trim().toLowerCase(),this.seeAlsoWords=[],this.setDictionaryState(null),this.morphologyReplaceRules.forEach(m=>{const l=v(this.currentTerm,m);l&&this.checkTerm(l)&&this.seeAlsoWords.push(l)}),!this.morphologyIsEmpty){const m=this.morphology[this.currentTerm];m?.o&&this.seeAlsoWords.push(m.o)}let d=this.checkTerm(this.currentTerm);if(d)this.setDictionaryState(d);else{if(!this.morphologyIsEmpty){const m=this.morphology[this.currentTerm];if(m?.o&&(d=this.checkTerm(m.o),d))return void this.setDictionaryState(d)}for(let m=0;m<this.morphologyReplaceRules.length;m++){const l=v(this.currentTerm,this.morphologyReplaceRules[m]);if(!l)continue;const p=this.checkTerm(l);if(p)return this.currentTerm=l,void this.setDictionaryState(p)}}}setDictionaryState(y){y?this.bookService.getDictionaryItem$(y).subscribe(d=>{this.currentDictionaryState$.next({currentDictionaryTerm:d,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}):this.setNullState()}setNullState(){this.seeAlsoWords=[],this.currentDictionaryState$.next({currentDictionaryTerm:null,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}checkTerm(y){return this.terms.includes(y)?y:""}static{this.\u0275fac=function(d){return new(d||_)(h.KVO(O.l))}}static{this.\u0275prov=h.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},7251:(D,E,s)=>{s.d(E,{f:()=>_});var n=s(4412),t=s(6697),C=s(7673),v=s(9040),h=s(4438),O=s(9456),r=s(9530);let _=(()=>{class f{constructor(d,m){this.dbService=d,this.infoService=m,this.examples$=new n.t([]),this.sort=(l,p)=>(l.toDoTimestamp||0)-(p.toDoTimestamp||0),this.dbService.getAll(v.Y.FavoriteExamples).pipe((0,t.s)(1)).subscribe(l=>{l.forEach(p=>p.showDetails=!1),l?(l.sort(this.sort),this.examples$.next(l)):this.examples$.next([])})}deleteAll(){return this.dbService.clear(v.Y.FavoriteExamples)}import(d){const m=JSON.parse(d)?.favoriteExamples;if(!m?.length)return console.error("!examples?.length"),this.infoService.error("!examples?.length"),(0,C.of)([]);const l=this.examples$.value.map(g=>g.timestamp);function p(g){return l.includes(g)?p(g+1):g}return m.forEach(g=>{if(!g.timestamp){const S=p(Date.now());l.push(S),g.timestamp=S}}),this.dbService.bulkAdd(v.Y.FavoriteExamples,m).pipe((0,t.s)(1))}addExample(d){const m=Date.now(),l={...d,timestamp:m,showDetails:!1};this.dbService.add(v.Y.FavoriteExamples,l).pipe((0,t.s)(1)).subscribe();const p=[l,...this.examples$.value];this.examples$.next(p),this.infoService.show("added: "+d.original)}update(d){if(!d?.timestamp||!d.toDoTimestamp)return;const m=this.examples$.value,l=m.find(p=>p.timestamp===d.timestamp);l&&(l.toDoTimestamp=d.toDoTimestamp,l.updateTimestamp=Date.now(),this.dbService.update(v.Y.FavoriteExamples,l).pipe((0,t.s)(1)).subscribe(),m.sort(this.sort),this.examples$.next(m))}removeExample(d){if(!d)return;this.dbService.delete(v.Y.FavoriteExamples,d).pipe((0,t.s)(1)).subscribe();const m=this.examples$.value.filter(l=>l.timestamp!==d);this.examples$.next(m)}static{this.\u0275fac=function(m){return new(m||f)(h.KVO(O.MX),h.KVO(r.O))}}static{this.\u0275prov=h.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})()},16:(D,E,s)=>{s.d(E,{b:()=>y});var n=s(9437),t=s(5558),C=s(8141),v=s(6697),h=s(6354),O=s(4438),r=s(1626),_=s(242),f=s(9530);let y=(()=>{class d{constructor(l,p,g){this.http=l,this.localStorageService=p,this.info=g,this.ankiHost=this.localStorageService.ankiHost}markCards(l){this.http.post(this.ankiHost,{action:"forgetCards",version:6,params:{cards:l}}).pipe((0,n.W)(p=>{throw this.info.error("There is error with anki-connection"),p}),(0,t.n)(()=>this.http.post(this.ankiHost,{action:"answerCards",version:6,params:{answers:l.map(p=>({cardId:p,ease:1}))}})),(0,C.M)(()=>this.info.show("Selected "+l.length+" items")),(0,v.s)(1)).subscribe()}addTagForNotes(l,p){this.http.post(this.ankiHost,{action:"addTags",version:6,params:{notes:l,tags:p}}).pipe((0,n.W)(g=>{throw this.info.error("There is error with anki-connection"),g}),(0,C.M)(()=>this.info.show("Tag added to "+l.length+" items")),(0,v.s)(1)).subscribe()}findCards(l){return this.http.post(this.ankiHost,{action:"findCards",version:6,params:{query:l}}).pipe((0,n.W)(p=>{throw this.info.error("There is error with anki-connection"),p}),(0,C.M)(p=>{p?.error&&this.info.error("Anki findCards error")}),(0,t.n)(p=>this.http.post(this.ankiHost,{action:"cardsInfo",version:6,params:{cards:p.result}}).pipe((0,C.M)(g=>{g?.error&&this.info.error("Anki findCards error")}),(0,h.T)(g=>g.result))))}findNotes(l){return this.http.post(this.ankiHost,{action:"findNotes",version:6,params:{query:l}}).pipe((0,n.W)(p=>{throw this.info.error("There is error with anki-connection"),p}),(0,C.M)(p=>{p?.error&&this.info.error("Anki findNotes error")}),(0,t.n)(p=>this.http.post(this.ankiHost,{action:"notesInfo",version:6,params:{notes:p.result}}).pipe((0,C.M)(g=>{g?.error&&this.info.error("Anki findCards error")}),(0,h.T)(g=>g.result))))}static{this.\u0275fac=function(p){return new(p||d)(O.KVO(r.Qq),O.KVO(_.s),O.KVO(f.O))}}static{this.\u0275prov=O.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},280:(D,E,s)=>{s.d(E,{b:()=>y});var n=s(4412),t=s(5558),C=s(6354),v=s(6697),h=s(7673),O=s(9040),r=s(4438),_=s(9456),f=s(3609);let y=(()=>{class d{constructor(l,p){this.dbService=l,this.dictionaryService=p,this.check$=new n.t(null),this.dictionaryService.currentDictionaryState$.pipe((0,t.n)(g=>this.getWordFromDB(g?.currentDictionaryTerm?.term||""))).subscribe(g=>{this.check$.next(g)})}importWords(l){return this.dbService.bulkAdd(O.Y.FavoriteWords,l.map(p=>({term:p,v:1})))}getAll(){return this.dbService.getAll(O.Y.FavoriteWords).pipe((0,C.T)(l=>l.map(p=>p.term)),(0,v.s)(1))}switchCurrent(){const l=this.check$.value,p=l?.term,g=l?.status;p&&(g?this.remove(p):this.add(p),this.check$.next({term:p,status:!g}))}add(l){this.dbService.add(O.Y.FavoriteWords,{term:l,v:"1"}).pipe((0,v.s)(1)).subscribe()}remove(l){this.dbService.delete(O.Y.FavoriteWords,l).pipe((0,v.s)(1)).subscribe()}deleteAll(){this.dbService.clear(O.Y.FavoriteWords).pipe((0,v.s)(1)).subscribe()}getWordFromDB(l){return l?this.dbService.getByID(O.Y.FavoriteWords,l).pipe((0,C.T)(p=>({term:l,status:!!p}))):(0,h.of)({term:"",status:!1})}static{this.\u0275fac=function(p){return new(p||d)(r.KVO(_.MX),r.KVO(f.K))}}static{this.\u0275prov=r.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},242:(D,E,s)=>{s.d(E,{s:()=>v});var n=function(h){return h.CurrentPopupMenuTab="CurrentPopupMenuTab",h.CopyToClipboard="CopyToClipboard",h.UseExternalId="UseExternalId",h.ShowDictionary="ShowDictionary",h.HideMarkedHeaders="HideMarkedHeaders",h.ShowTranslationInBook="ShowTranslationInBook",h.AutoTranslateSelected="AutoTranslateSelected",h.ShowTranslatorInDictionaryViewer="ShowTranslatorInDictionaryViewer",h.AudioVoiceURI="AudioVoiceURI",h.AudioVolume="AudioVolume",h.AudioRate="AudioRate",h.AnkiDeck="AnkiDeck",h.AnkiHost="AnkiHost",h}(n||{}),t=s(1177),C=s(4438);let v=(()=>{class h{get ankiHost(){return localStorage.getItem(n.AnkiHost)||t.jk}set ankiHost(r){localStorage.setItem(n.AnkiHost,r||"")}get ankiDeck(){return localStorage.getItem(n.AnkiDeck)||""}set ankiDeck(r){localStorage.setItem(n.AnkiDeck,r||"")}get audioVoiceURI(){return localStorage.getItem(n.AudioVoiceURI)||""}set audioVoiceURI(r){localStorage.setItem(n.AudioVoiceURI,r||"")}get audioVolume(){return this.getNumber(n.AudioVolume,1)}set audioVolume(r){this.setNumber(n.AudioVolume,0===r?0:r||1)}get audioRate(){return this.getNumber(n.AudioRate,1)}set audioRate(r){this.setNumber(n.AudioRate,0===r?0:r||1)}get hideMarkedHeaders(){return this.getBoolean(n.HideMarkedHeaders,!1)}set hideMarkedHeaders(r){this.setBoolean(n.HideMarkedHeaders,r)}get copyToClipboard(){return this.getBoolean(n.CopyToClipboard,!1)}set copyToClipboard(r){this.setBoolean(n.CopyToClipboard,r)}get useExternalId(){return this.getBoolean(n.UseExternalId,!1)}set useExternalId(r){this.setBoolean(n.UseExternalId,r)}get showDictionary(){return this.getBoolean(n.ShowDictionary,!0)}set showDictionary(r){this.setBoolean(n.ShowDictionary,r)}get showTranslationInBook(){return this.getBoolean(n.ShowTranslationInBook,!0)}set showTranslationInBook(r){this.setBoolean(n.ShowTranslationInBook,r)}get currentPopupMenuTab(){return this.getNumber(n.CurrentPopupMenuTab)}set currentPopupMenuTab(r){this.setNumber(n.CurrentPopupMenuTab,r||0)}constructor(){this.trueString="true",this.falseString="false"}getString(r,_=""){return localStorage.getItem(r)||_}setString(r,_){localStorage.setItem(r,_)}setNumber(r,_){localStorage.setItem(r,String(_||0))}getNumber(r,_=0){const f=localStorage.getItem(r);if(null===f)return _;const y=+f;return Number.isNaN(y)?_:y}setBoolean(r,_){localStorage.setItem(r,_?this.trueString:this.falseString)}getBoolean(r,_=!1){const f=localStorage.getItem(r);return f===this.trueString||f!==this.falseString&&_}static{this.\u0275fac=function(_){return new(_||h)}}static{this.\u0275prov=C.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},3716:(D,E,s)=>{s.d(E,{T:()=>C});const t=["\u2018","\u201c"," ",".",",","!","?",":",";","\t","\n","\r","'","`","\u2019",'"',"\\","/","[","]","(",")","{","}","-","\u2014","<",">"];function C(){const v=window.getSelection();if(!v)return"";const h=v.toString().trim();if(h)return h;const O=v.focusOffset,r=v.focusNode?.nodeValue;if(!r)return"";const _=r.split("");let f=function n(v,h,O){let r=h;for(;r--;)if(O(v[r],r,v))return r;return-1}(_,O,d=>t.includes(d));f=-1===f?0:f+1;let y=_.findIndex((d,m)=>t.includes(d)&&m>O);return-1===y&&(y=r.length),r.slice(f,y).trim()}},850:(D,E,s)=>{s.d(E,{$3:()=>z,jL:()=>q,pN:()=>F});var n=s(4438),t=s(6600),C=s(177),v=s(3980),h=s(6969),O=s(8617),r=s(6860),_=s(9969),f=s(8359),y=s(1413),d=s(9030),m=s(7786),l=s(7673),p=s(3726),g=s(7336),S=s(6939),W=s(9417),w=s(882),B=s(9172),b=s(5558),A=s(6697),I=s(5964),L=s(6354),j=s(8141),U=s(1986),K=s(8203);const $=["panel"],V=["*"];function N(M,c){if(1&M){const i=n.RV6();n.j41(0,"div",1,0),n.bIt("@panelAnimation.done",function(o){n.eBV(i);const a=n.XpG();return n.Njj(a._animationDone.next(o))}),n.SdG(2),n.k0s()}if(2&M){const i=c.id,e=n.XpG();n.HbH(e._classList),n.AVh("mat-mdc-autocomplete-visible",e.showPanel)("mat-mdc-autocomplete-hidden",!e.showPanel)("mat-primary","primary"===e._color)("mat-accent","accent"===e._color)("mat-warn","warn"===e._color),n.Y8G("id",e.id)("@panelAnimation",e.isOpen?"visible":"hidden"),n.BMQ("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby(i))}}const X=(0,_.hZ)("panelAnimation",[(0,_.wk)("void, hidden",(0,_.iF)({opacity:0,transform:"scaleY(0.8)"})),(0,_.kY)(":enter, hidden => visible",[(0,_.Os)([(0,_.i0)("0.03s linear",(0,_.iF)({opacity:1})),(0,_.i0)("0.12s cubic-bezier(0, 0, 0.2, 1)",(0,_.iF)({transform:"scaleY(1)"}))])]),(0,_.kY)(":leave, visible => hidden",[(0,_.i0)("0.075s linear",(0,_.iF)({opacity:0}))])]);let H=0;class G{constructor(c,i){this.source=c,this.option=i}}const k=new n.nKC("mat-autocomplete-default-options",{providedIn:"root",factory:function Y(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1}}});let z=(()=>{class M{get isOpen(){return this._isOpen&&this.showPanel}_setColor(i){this._color=i,this._changeDetectorRef.markForCheck()}set classList(i){this._classList=i,this._elementRef.nativeElement.className=""}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(i){this._hideSingleSelectionIndicator=i,this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const i of this.options)i._changeDetectorRef.markForCheck()}constructor(i,e,o,a){this._changeDetectorRef=i,this._elementRef=e,this._defaults=o,this._activeOptionChanges=f.yU.EMPTY,this._animationDone=new n.bkB,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new n.bkB,this.opened=new n.bkB,this.closed=new n.bkB,this.optionActivated=new n.bkB,this.id="mat-autocomplete-"+H++,this.inertGroups=a?.SAFARI||!1,this.autoActiveFirstOption=!!o.autoActiveFirstOption,this.autoSelectActiveOption=!!o.autoSelectActiveOption,this.requireSelection=!!o.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new O.Au(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(i=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[i]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe(),this._animationDone.complete()}_setScrollTop(i){this.panel&&(this.panel.nativeElement.scrollTop=i)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(i){const e=new G(this,i);this.optionSelected.emit(e)}_getPanelAriaLabelledby(i){return this.ariaLabel?null:this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_skipPredicate(){return!1}static{this.\u0275fac=function(e){return new(e||M)(n.rXU(n.gRc),n.rXU(n.aKT),n.rXU(k),n.rXU(r.OD))}}static{this.\u0275cmp=n.VBU({type:M,selectors:[["mat-autocomplete"]],contentQueries:function(e,o,a){if(1&e&&(n.wni(a,t.wT,5),n.wni(a,t.QC,5)),2&e){let u;n.mGM(u=n.lsd())&&(o.options=u),n.mGM(u=n.lsd())&&(o.optionGroups=u)}},viewQuery:function(e,o){if(1&e&&(n.GBs(n.C4Q,7),n.GBs($,5)),2&e){let a;n.mGM(a=n.lsd())&&(o.template=a.first),n.mGM(a=n.lsd())&&(o.panel=a.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[n.Mj6.None,"aria-label","ariaLabel"],ariaLabelledby:[n.Mj6.None,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[n.Mj6.HasDecoratorInputTransform,"autoActiveFirstOption","autoActiveFirstOption",n.L39],autoSelectActiveOption:[n.Mj6.HasDecoratorInputTransform,"autoSelectActiveOption","autoSelectActiveOption",n.L39],requireSelection:[n.Mj6.HasDecoratorInputTransform,"requireSelection","requireSelection",n.L39],panelWidth:"panelWidth",disableRipple:[n.Mj6.HasDecoratorInputTransform,"disableRipple","disableRipple",n.L39],classList:[n.Mj6.None,"class","classList"],hideSingleSelectionIndicator:[n.Mj6.HasDecoratorInputTransform,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",n.L39]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],standalone:!0,features:[n.Jv_([{provide:t.is,useExisting:M}]),n.GFd,n.aNF],ngContentSelectors:V,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(e,o){1&e&&(n.NAR(),n.DNE(0,N,3,16,"ng-template"))},styles:["div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:static;border-radius:var(--mat-autocomplete-container-shape);box-shadow:var(--mat-autocomplete-container-elevation-shadow);background-color:var(--mat-autocomplete-background-color)}.cdk-high-contrast-active div.mat-mdc-autocomplete-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}mat-autocomplete{display:none}"],encapsulation:2,data:{animation:[X]},changeDetection:0})}}return M})();const Q={provide:W.kq,useExisting:(0,n.Rfq)(()=>F),multi:!0},x=new n.nKC("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{const M=(0,n.WQX)(h.hJ);return()=>M.scrollStrategies.reposition()}}),Z={provide:x,deps:[h.hJ],useFactory:function J(M){return()=>M.scrollStrategies.reposition()}};let F=(()=>{class M{constructor(i,e,o,a,u,P,R,nt,ot,st,at){this._element=i,this._overlay=e,this._viewContainerRef=o,this._zone=a,this._changeDetectorRef=u,this._dir=R,this._formField=nt,this._document=ot,this._viewportRuler=st,this._defaults=at,this._componentDestroyed=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=f.yU.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new y.B,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="mat-mdc-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=(0,d.v)(()=>{const T=this.autocomplete?this.autocomplete.options:null;return T?T.changes.pipe((0,B.Z)(T),(0,b.n)(()=>(0,m.h)(...T.map(rt=>rt.onSelectionChange)))):this._zone.onStable.pipe((0,A.s)(1),(0,b.n)(()=>this.optionSelections))}),this._handlePanelKeydown=T=>{(T.keyCode===g._f&&!(0,g.rp)(T)||T.keyCode===g.i7&&(0,g.rp)(T,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),T.stopPropagation(),T.preventDefault())},this._trackedModal=null,this._scrollStrategy=P}ngAfterViewInit(){const i=this._getWindow();typeof i<"u"&&this._zone.runOutsideAngular(()=>i.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(i){i.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const i=this._getWindow();typeof i<"u"&&i.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&(0,O.Ae)(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return(0,m.h)(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe((0,I.p)(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe((0,I.p)(()=>this._overlayAttached)):(0,l.of)()).pipe((0,L.T)(i=>i instanceof t.MI?i:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return(0,m.h)((0,p.R)(this._document,"click"),(0,p.R)(this._document,"auxclick"),(0,p.R)(this._document,"touchend")).pipe((0,I.p)(i=>{const e=(0,r.Fb)(i),o=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,a=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&e!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!o||!o.contains(e))&&(!a||!a.contains(e))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(e)}))}writeValue(i){Promise.resolve(null).then(()=>this._assignOptionValue(i))}registerOnChange(i){this._onChange=i}registerOnTouched(i){this._onTouched=i}setDisabledState(i){this._element.nativeElement.disabled=i}_handleKeydown(i){const e=i.keyCode,o=(0,g.rp)(i);if(e===g._f&&!o&&i.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&e===g.Fm&&this.panelOpen&&!o)this.activeOption._selectViaInteraction(),this._resetActiveItem(),i.preventDefault();else if(this.autocomplete){const a=this.autocomplete._keyManager.activeItem,u=e===g.i7||e===g.n6;e===g.wn||u&&!o&&this.panelOpen?this.autocomplete._keyManager.onKeydown(i):u&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(u||this.autocomplete._keyManager.activeItem!==a)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(i){let e=i.target,o=e.value;if("number"===e.type&&(o=""==o?null:parseFloat(o)),this._previousValue!==o){if(this._previousValue=o,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(o),o){if(this.panelOpen&&!this.autocomplete.requireSelection){const a=this.autocomplete.options?.find(u=>u.selected);a&&o!==this._getDisplayValue(a.value)&&a.deselect(!1)}}else this._clearPreviousSelectedOption(null,!1);if(this._canOpen()&&this._document.activeElement===i.target){const a=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(a)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_floatLabel(i=!1){this._formField&&"auto"===this._formField.floatLabel&&(i?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){const i=this._zone.onStable.pipe((0,A.s)(1)),e=this.autocomplete.options.changes.pipe((0,j.M)(()=>this._positionStrategy.reapplyLastPosition()),(0,U.c)(0));return(0,m.h)(i,e).pipe((0,b.n)(()=>(this._zone.run(()=>{const o=this.panelOpen;this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),o!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit())}),this.panelClosingActions)),(0,A.s)(1)).subscribe(o=>this._setValueAndClose(o))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(i){const e=this.autocomplete;return e&&e.displayWith?e.displayWith(i):i}_assignOptionValue(i){const e=this._getDisplayValue(i);null==i&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(e??"")}_updateNativeInputValue(i){this._formField?this._formField._control.value=i:this._element.nativeElement.value=i,this._previousValue=i}_setValueAndClose(i){const e=this.autocomplete,o=i?i.source:this._pendingAutoselectedOption;o?(this._clearPreviousSelectedOption(o),this._assignOptionValue(o.value),this._onChange(o.value),e._emitSelectEvent(o),this._element.nativeElement.focus()):e.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),e._animationDone?e._animationDone.pipe((0,A.s)(1)).subscribe(()=>this._onChange(null)):this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(i,e){this.autocomplete?.options?.forEach(o=>{o!==i&&o.selected&&o.deselect(e)})}_openPanelInternal(i=this._element.nativeElement.value){this._attachOverlay(i),this._floatLabel(),this._trackedModal&&(0,O.px)(this._trackedModal,"aria-owns",this.autocomplete.id)}_attachOverlay(i){let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new S.VA(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._valueOnAttach=i,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());const o=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&o!==this.panelOpen&&this._emitOpened()}_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){const i=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=i.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=i.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new h.rR({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){const i=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(i),this._positionStrategy=i,i}_setStrategyPositions(i){const e=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],o=this._aboveClass,a=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:o},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:o}];let u;u="above"===this.position?a:"below"===this.position?e:[...e,...a],i.withPositions(u)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const i=this.autocomplete;if(i.autoActiveFirstOption){let e=-1;for(let o=0;o<i.options.length;o++)if(!i.options.get(o).disabled){e=o;break}i._keyManager.setActiveItem(e)}else i._keyManager.setActiveItem(-1)}_canOpen(){const i=this._element.nativeElement;return!i.readOnly&&!i.disabled&&!this.autocompleteDisabled}_getWindow(){return this._document?.defaultView||window}_scrollToOption(i){const e=this.autocomplete,o=(0,t.jb)(i,e.options,e.optionGroups);if(0===i&&1===o)e._setScrollTop(0);else if(e.panel){const a=e.options.toArray()[i];if(a){const u=a._getHostElement(),P=(0,t.TL)(u.offsetTop,u.offsetHeight,e._getScrollTop(),e.panel.nativeElement.offsetHeight);e._setScrollTop(P)}}}_applyModalPanelOwnership(){const i=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!i)return;const e=this.autocomplete.id;this._trackedModal&&(0,O.Ae)(this._trackedModal,"aria-owns",e),(0,O.px)(i,"aria-owns",e),this._trackedModal=i}_clearFromModal(){this._trackedModal&&((0,O.Ae)(this._trackedModal,"aria-owns",this.autocomplete.id),this._trackedModal=null)}static{this.\u0275fac=function(e){return new(e||M)(n.rXU(n.aKT),n.rXU(h.hJ),n.rXU(n.c1b),n.rXU(n.SKi),n.rXU(n.gRc),n.rXU(x),n.rXU(K.dS,8),n.rXU(w.xb,9),n.rXU(C.qQ,8),n.rXU(v.Xj),n.rXU(k,8))}}static{this.\u0275dir=n.FsC({type:M,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(e,o){1&e&&n.bIt("focusin",function(){return o._handleFocus()})("blur",function(){return o._onTouched()})("input",function(u){return o._handleInput(u)})("keydown",function(u){return o._handleKeydown(u)})("click",function(){return o._handleClick()}),2&e&&n.BMQ("autocomplete",o.autocompleteAttribute)("role",o.autocompleteDisabled?null:"combobox")("aria-autocomplete",o.autocompleteDisabled?null:"list")("aria-activedescendant",o.panelOpen&&o.activeOption?o.activeOption.id:null)("aria-expanded",o.autocompleteDisabled?null:o.panelOpen.toString())("aria-controls",o.autocompleteDisabled||!o.panelOpen||null==o.autocomplete?null:o.autocomplete.id)("aria-haspopup",o.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[n.Mj6.None,"matAutocomplete","autocomplete"],position:[n.Mj6.None,"matAutocompletePosition","position"],connectedTo:[n.Mj6.None,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[n.Mj6.None,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[n.Mj6.HasDecoratorInputTransform,"matAutocompleteDisabled","autocompleteDisabled",n.L39]},exportAs:["matAutocompleteTrigger"],standalone:!0,features:[n.Jv_([Q]),n.GFd,n.OA$]})}}return M})(),q=(()=>{class M{static{this.\u0275fac=function(e){return new(e||M)}}static{this.\u0275mod=n.$C({type:M})}static{this.\u0275inj=n.G2t({providers:[Z],imports:[h.z_,t.Sy,t.yE,C.MD,v.Gj,t.Sy,t.yE]})}}return M})()}}]);