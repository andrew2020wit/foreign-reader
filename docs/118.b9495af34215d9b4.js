"use strict";(self.webpackChunkforeign_reader=self.webpackChunkforeign_reader||[]).push([[118],{4861:(b,T,n)=>{n.d(T,{E:()=>p});var M=n(5619),x=n(2572),f=n(8180);function g(d,u){const r=u.index>=0?u.index:d.length+u.index;if(d.slice(r,r+u.pattern.length)!==u.pattern)return null;const s=d.length-(d.slice(0,u.index).length+u.pattern.length);let t=d.slice(0,u.index)+u.replace;return s>0&&(t+=d.slice(-1*s)),t}var k=n(5879),m=n(5071);let p=(()=>{class d{constructor(r){this.bookService=r,this.currentDictionaryState$=new M.X(null),this.minimalSearchPattern=2,this.maxNumberOfSearchResults=50,this.morphology={},this.morphologyReplaceRules=[],this.dictionaryIsEmpty=!0,this.morphologyIsEmpty=!0,this.searchTerm="",this.currentTerm="",this.terms=[],this.seeAlsoWords=[],(0,x.a)([this.bookService.getMorphology$(),this.bookService.getDictionaryTerms$(),this.bookService.getMorphologyReplaceRules$()]).pipe((0,f.q)(1)).subscribe(([s,t,o])=>{s?.morphology?(this.morphology=s.morphology,this.morphologyIsEmpty=!1):(this.morphology={},this.morphologyIsEmpty=!0),this.morphologyReplaceRules=o?.morphologyReplaceRules?o.morphologyReplaceRules:[],t.length?(this.terms=t,this.dictionaryIsEmpty=!1):this.dictionaryIsEmpty=!0,this.setDictionaryState(null),this.searchTerm&&this.setTerm(this.searchTerm)})}searchTerms(r){if(r.length<this.minimalSearchPattern)return null;const s=new RegExp(r.replaceAll("*",".+"),"iu");return this.terms.filter(t=>s.test(t)).slice(0,this.maxNumberOfSearchResults)}setTerm(r){if(this.searchTerm=r,this.currentTerm=r.trim().toLowerCase(),this.seeAlsoWords=[],this.setDictionaryState(null),this.morphologyReplaceRules.forEach(t=>{const o=g(this.currentTerm,t);o&&this.checkTerm(o)&&this.seeAlsoWords.push(o)}),!this.morphologyIsEmpty){const t=this.morphology[this.currentTerm];t?.o&&this.seeAlsoWords.push(t.o)}let s=this.checkTerm(this.currentTerm);if(s)this.setDictionaryState(s);else{if(!this.morphologyIsEmpty){const t=this.morphology[this.currentTerm];if(t?.o&&(s=this.checkTerm(t.o),s))return void this.setDictionaryState(s)}for(let t=0;t<this.morphologyReplaceRules.length;t++){const o=g(this.currentTerm,this.morphologyReplaceRules[t]);if(!o)continue;const h=this.checkTerm(o);if(h)return this.currentTerm=o,void this.setDictionaryState(h)}}}setDictionaryState(r){r?this.bookService.getDictionaryItem$(r).subscribe(s=>{this.currentDictionaryState$.next({currentDictionaryTerm:s,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}):this.setNullState()}setNullState(){this.seeAlsoWords=[],this.currentDictionaryState$.next({currentDictionaryTerm:null,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}checkTerm(r){return this.terms.includes(r)?r:""}}return d.\u0275fac=function(r){return new(r||d)(k.LFG(m.Z))},d.\u0275prov=k.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},2118:(b,T,n)=>{n.r(T),n.d(T,{FavoriteWordPageComponent:()=>_});var M=n(7582),x=n(1791),f=n(6814),g=n(2296),k=n(617),m=n(9157),p=n(6223),d=n(2032),u=n(8180),r=n(2945),s=n(2058),t=n(5879),o=n(5591),h=n(6306),v=n(9397),A=n(4664),S=n(7398),F=n(9862),O=n(2969),W=n(957);let I=(()=>{class c{constructor(e,l,a){this.http=e,this.localStorageService=l,this.info=a,this.ankiHost=this.localStorageService.ankiHost}addTagForNotes(e,l){this.http.post(this.ankiHost,{action:"addTags",version:6,params:{notes:e,tags:l}}).pipe((0,h.K)(a=>{throw this.info.error("There is error with anki-connection"),a}),(0,v.b)(()=>this.info.show("Tag added to "+e.length+" items")),(0,u.q)(1)).subscribe()}findNotes(e){return this.http.post(this.ankiHost,{action:"findNotes",version:6,params:{query:e}}).pipe((0,h.K)(l=>{throw this.info.error("There is error with anki-connection"),l}),(0,v.b)(l=>{l?.error&&this.info.error("Anki findNotes error")}),(0,A.w)(l=>this.http.post(this.ankiHost,{action:"notesInfo",version:6,params:{notes:l.result}}).pipe((0,v.b)(a=>{a?.error&&this.info.error("Anki findCards error")}),(0,S.U)(a=>a.result))))}}return c.\u0275fac=function(e){return new(e||c)(t.LFG(F.eN),t.LFG(O.n),t.LFG(W.C))},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})();var y;function R(c,i){if(1&c){const e=t.EpF();t.TgZ(0,"div",19)(1,"div",20)(2,"button",21),t.NdJ("click",function(){const C=t.CHM(e).$implicit,P=t.oxw();return t.KtG(P.remove(C))}),t.TgZ(3,"mat-icon"),t._uU(4,"star"),t.qZA()()(),t.TgZ(5,"div",22),t.NdJ("click",function(){const C=t.CHM(e).$implicit,P=t.oxw();return t.KtG(P.selectTerm(C))}),t.TgZ(6,"button",23),t._uU(7),t.qZA()()()}if(2&c){const e=i.$implicit;t.xp6(2),t.Q6J("color","accent"),t.xp6(5),t.hij(" ",e," ")}}function E(c,i){if(1&c){const e=t.EpF();t.TgZ(0,"div",24)(1,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectAll())}),t._uU(2," Select All "),t.qZA(),t.TgZ(3,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.deselectAll())}),t._uU(4," Deselect "),t.qZA(),t.TgZ(5,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.addTag())}),t._uU(6," Add tag to selected "),t.qZA()()}if(2&c){const e=t.oxw();t.xp6(1),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("disabled",!e.ankiRequestText)}}function Z(c,i){if(1&c&&(t.TgZ(0,"div",30),t._uU(1),t.qZA()),2&c){const e=t.oxw().$implicit;t.xp6(1),t.hij(" tags: ",null==e.tags?null:e.tags.join(" | ")," ")}}function D(c,i){if(1&c){const e=t.EpF();t.TgZ(0,"div",25),t.NdJ("click",function(){const C=t.CHM(e).$implicit;return t.KtG(C.selected=!C.selected)}),t.TgZ(1,"div",26),t._uU(2),t.qZA(),t.TgZ(3,"div",27),t._uU(4),t.qZA(),t.TgZ(5,"div",28),t._uU(6),t.qZA(),t.YNc(7,Z,2,1,"div",29),t.qZA()}if(2&c){const e=i.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Q0o(" ",null==e.fields.term?null:e.fields.term.value," (",null==e.fields.pos?null:e.fields.pos.value,") ",null==e.fields.freq?null:e.fields.freq.value," ",null==e.fields.freq2?null:e.fields.freq2.value," [ ",e.modelName," ",null==e.fields.sensenum?null:e.fields.sensenum.value," ",null==e.fields.exampleId?null:e.fields.exampleId.value," ] "),t.xp6(2),t.hij(" ",null==e.fields.exampleText?null:e.fields.exampleText.value," "),t.xp6(2),t.hij(" ",null==e.fields.def?null:e.fields.def.value," "),t.xp6(1),t.Q6J("ngIf",null==e.tags?null:e.tags.length)}}let _=((y=class{constructor(i,e,l,a,C){this.favoriteWordsService=i,this.ankiConnectService=e,this.cdr=l,this.info=a,this.localStorageService=C,this.favoriteWordList=[],this.textForImport="",this.ankiHost=this.localStorageService.ankiHost,this.ankiDeck=this.localStorageService.ankiDeck,this.tag=localStorage.getItem(r.wf)||"selected",this.ankiRequestText=localStorage.getItem(r.N3)||"flag:2",this.ankiResultList=[],this.resultNumber=0,this.maxAnkiResultNumber=r.KM}ngOnInit(){this.favoriteWordsService.getAll().pipe((0,x.t)(this)).subscribe(i=>{this.favoriteWordList=i||[],this.cdr.detectChanges()})}selectAll(){this.ankiResultList.forEach(i=>i.selected=!0),this.cdr.detectChanges()}deselectAll(){this.ankiResultList.forEach(i=>i.selected=!1),this.cdr.detectChanges()}selectTerm(i){let e="";this.ankiDeck&&(e+="deck:"+this.ankiDeck+" "),e+="term:"+i,this.ankiRequestText=e,this.request()}addTag(){if(!this.tag)return void this.info.error("Wrong tag");const i=this.ankiResultList.filter(e=>e.selected&&!e.tags?.includes(this.tag)).map(e=>e.noteId);i.length?(localStorage.setItem(r.wf,this.tag),this.ankiConnectService.addTagForNotes(i,this.tag)):this.info.error("Nothing to add!")}request(){this.ankiRequestText&&(localStorage.setItem(r.N3,this.ankiRequestText),this.ankiConnectService.findNotes(this.ankiRequestText).pipe((0,u.q)(1)).subscribe(i=>{this.resultNumber=i.length,this.ankiResultList=i.slice(0,r.KM),this.cdr.detectChanges()}))}importText(){const i=this.textForImport.replaceAll(/\s+/g," ").split(" ").filter(e=>!this.favoriteWordList.includes(e));this.favoriteWordsService.importWords(i).pipe((0,u.q)(1)).subscribe(),this.textForImport="",this.favoriteWordList=[...this.favoriteWordList,...i],this.cdr.detectChanges()}remove(i){this.favoriteWordsService.remove(i),this.favoriteWordList=this.favoriteWordList.filter(e=>e!==i),this.cdr.detectChanges()}}).\u0275fac=function(i){return new(i||y)(t.Y36(o.d),t.Y36(I),t.Y36(t.sBO),t.Y36(W.C),t.Y36(O.n))},y.\u0275cmp=t.Xpm({type:y,selectors:[["app-favorite-word-page"]],standalone:!0,features:[t.jDz],decls:32,vars:10,consts:[[1,"top-block"],[1,"favorite-word-list"],["mat-button","","color","primary","routerLink","/"],["class","favorite-word-list-item",4,"ngFor","ngForOf"],[1,"anki-connect-block"],[1,"settings"],[1,"anki-result-sum"],["appearance","outline"],["matInput","",1,"flag-input",3,"ngModel","ngModelChange"],[1,"anki-request"],["appearance","outline",1,"request-mat-form-field"],["matInput","",1,"flag-input",3,"ngModel","keydown.enter","ngModelChange"],["mat-button","","color","primary",3,"disabled","click"],["class","buttons",4,"ngIf"],[1,"result-items"],["class","result-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"import-block"],["appearance","outline",1,"description"],["matInput","",1,"import-text-area",3,"ngModel","ngModelChange"],[1,"favorite-word-list-item"],[1,"star"],["mat-icon-button","",1,"favorite-word-button",3,"color","click"],[1,"term",3,"click"],["mat-button","","color","primary",1,"term-button"],[1,"buttons"],[1,"result-item",3,"click"],[1,"top"],[1,"example"],[1,"def"],["class","tags",4,"ngIf"],[1,"tags"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._uU(3," Home "),t.qZA(),t.YNc(4,R,8,2,"div",3),t.qZA(),t.TgZ(5,"div",4)(6,"div",5)(7,"div",6),t._uU(8),t.qZA(),t.TgZ(9,"mat-form-field",7)(10,"mat-label"),t._uU(11,"Anki tag to add"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(a){return e.tag=a}),t.qZA()()(),t.TgZ(13,"div",9)(14,"mat-form-field",10)(15,"mat-label"),t._uU(16,"Anki request text"),t.qZA(),t.TgZ(17,"input",11),t.NdJ("keydown.enter",function(){return e.request()})("ngModelChange",function(a){return e.ankiRequestText=a}),t.qZA()(),t.TgZ(18,"button",12),t.NdJ("click",function(){return e.request()}),t._uU(19,"Go! "),t.qZA()(),t.YNc(20,E,7,3,"div",13),t.TgZ(21,"div",14),t.YNc(22,D,8,12,"div",15),t.qZA()()(),t.TgZ(23,"h2"),t._uU(24,"Import"),t.qZA(),t.TgZ(25,"div",16)(26,"mat-form-field",17)(27,"mat-label"),t._uU(28,"Words to import"),t.qZA(),t.TgZ(29,"textarea",18),t.NdJ("ngModelChange",function(a){return e.textForImport=a}),t.qZA()(),t.TgZ(30,"button",12),t.NdJ("click",function(){return e.importText()}),t._uU(31,"Import "),t.qZA()()),2&i&&(t.xp6(4),t.Q6J("ngForOf",e.favoriteWordList),t.xp6(4),t.AsE(" Anki-connect, resultNumber: ",e.resultNumber,", max: ",e.maxAnkiResultNumber," "),t.xp6(4),t.Q6J("ngModel",e.tag),t.xp6(5),t.Q6J("ngModel",e.ankiRequestText),t.xp6(1),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("ngIf",null==e.ankiResultList?null:e.ankiResultList.length),t.xp6(2),t.Q6J("ngForOf",e.ankiResultList),t.xp6(7),t.Q6J("ngModel",e.textForImport),t.xp6(1),t.Q6J("disabled",!e.textForImport))},dependencies:[f.ez,f.sg,f.O5,g.ot,g.lW,g.RK,k.Ps,k.Hw,m.lN,m.KE,m.hX,p.u5,p.Fj,p.JJ,p.On,d.c,d.Nt,s.rH],styles:["[_nghost-%COMP%]{display:block;padding:24px}.top-block[_ngcontent-%COMP%]{display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]{flex:1}.anki-connect-block[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:start;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .anki-request[_ngcontent-%COMP%]{width:100%;display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .anki-request[_ngcontent-%COMP%]   .request-mat-form-field[_ngcontent-%COMP%]{flex:1}.anki-connect-block[_ngcontent-%COMP%]   .anki-result-sum[_ngcontent-%COMP%]{color:#00f}.anki-connect-block[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]{border:1px solid lightgray;margin:16px 0;padding:4px 8px;cursor:pointer}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item.selected[_ngcontent-%COMP%]{border:1px solid green}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{color:gray}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%]{margin:8px 0}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .def[_ngcontent-%COMP%]{color:gray}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{color:green}.favorite-word-list[_ngcontent-%COMP%]   .favorite-word-list-item[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.favorite-word-list[_ngcontent-%COMP%]   .term-button[_ngcontent-%COMP%]{justify-content:start;max-width:200px;min-width:100px;overflow:clip}.import-block[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 100px}.import-block[_ngcontent-%COMP%]   .import-text-area[_ngcontent-%COMP%]{height:400px}"]}),y);_=(0,M.gn)([(0,x.c)()],_)},5591:(b,T,n)=>{n.d(T,{d:()=>r});var M=n(5619),x=n(4664),f=n(7398),g=n(8180),k=n(2096),m=n(7772),p=n(5879),d=n(6280),u=n(4861);let r=(()=>{class s{constructor(o,h){this.dbService=o,this.dictionaryService=h,this.check$=new M.X(null),this.dictionaryService.currentDictionaryState$.pipe((0,x.w)(v=>this.getWordFromDB(v?.currentDictionaryTerm?.term||""))).subscribe(v=>{this.check$.next(v)})}importWords(o){return this.dbService.bulkAdd(m.L.FavoriteWords,o.map(h=>({term:h,v:1})))}getAll(){return this.dbService.getAll(m.L.FavoriteWords).pipe((0,f.U)(o=>o.map(h=>h.term)),(0,g.q)(1))}switchCurrent(){const o=this.check$.value,h=o?.term,v=o?.status;h&&(v?this.remove(h):this.add(h),this.check$.next({term:h,status:!v}))}add(o){this.dbService.add(m.L.FavoriteWords,{term:o,v:"1"}).pipe((0,g.q)(1)).subscribe()}remove(o){this.dbService.delete(m.L.FavoriteWords,o).pipe((0,g.q)(1)).subscribe()}getWordFromDB(o){return o?this.dbService.getByID(m.L.FavoriteWords,o).pipe((0,f.U)(h=>({term:o,status:!!h}))):(0,k.of)({term:"",status:!1})}}return s.\u0275fac=function(o){return new(o||s)(p.LFG(d.ys),p.LFG(u.E))},s.\u0275prov=p.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()}}]);