"use strict";(self.webpackChunkforeign_reader=self.webpackChunkforeign_reader||[]).push([[111],{2945:(S,E,s)=>{s.d(E,{KM:()=>t,N3:()=>O,s7:()=>o,wf:()=>T});const o="http://127.0.0.1:8765",t=500,T="ankiTag",O="ankiRequestText"},111:(S,E,s)=>{s.d(E,{V:()=>R});var x,o=s(7582),t=s(5879),T=s(6814),O=s(1791),u=s(2296),y=s(617),r=s(6223),g=s(4630),h=s(9157),v=s(2032),d=s(3680),m=s(8299),c=s(8180),f=s(7398),M=s(2945),A=s(5591),B=s(4861),L=s(3631),F=s(2969),U=s(957),b=s(8495);const I=["topMarker"];function K(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"mat-option",15),t.NdJ("keyup.enter",function(){const n=t.CHM(i).$implicit,p=t.oxw();return t.KtG(p.selectTermOption(n))})("click",function(){const n=t.CHM(i).$implicit,p=t.oxw();return t.KtG(p.selectTermOption(n))}),t._uU(1),t.qZA()}if(2&l){const i=a.$implicit;t.Q6J("value",i),t.xp6(1),t.hij(" ",i," ")}}function N(l,a){1&l&&(t.TgZ(0,"div",16),t._uU(1," dictionaryIsEmpty\n"),t.qZA())}function Z(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"div",19),t.NdJ("click",function(){const n=t.CHM(i).$implicit,p=t.oxw(2);return t.KtG(p.selectPartOfSpeech(n))}),t._uU(1),t.qZA()}if(2&l){const i=a.$implicit,_=t.oxw(2);t.ekj("selected",_.selectedPartsOfSpeech.includes(i)),t.xp6(1),t.hij(" ",i," ")}}function Y(l,a){if(1&l&&(t.TgZ(0,"div",17),t.YNc(1,Z,2,3,"div",18),t.qZA()),2&l){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i.partsOfSpeech)}}function H(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.favoriteWordsService.switchCurrent())}),t.TgZ(1,"mat-icon"),t._uU(2,"star"),t.qZA()()}if(2&l){const i=t.oxw();t.Q6J("color",null!=i.favoriteWordStatus&&i.favoriteWordStatus.status?"accent":"primary")}}function j(l,a){1&l&&(t.ynx(0),t._uU(1," => "),t.BQk())}function V(l,a){if(1&l&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,j,2,0,"ng-container",12),t.qZA()),2&l){const i=t.oxw();t.xp6(1),t.hij(" ",i.searchTerm," "),t.xp6(1),t.Q6J("ngIf",null==i.dictionaryTerm?null:i.dictionaryTerm.term)}}function $(l,a){if(1&l&&(t.TgZ(0,"span",27),t._uU(1),t.qZA()),2&l){const i=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",i.transcription," ")}}function J(l,a){if(1&l&&(t.TgZ(0,"span",28),t._uU(1),t.qZA()),2&l){const i=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",i.dictionaryName," ")}}function G(l,a){if(1&l&&(t.TgZ(0,"div",40),t._uU(1),t.qZA()),2&l){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i.lexicalUnit," ")}}function Q(l,a){if(1&l&&(t.TgZ(0,"span",41),t._uU(1),t.qZA()),2&l){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.level)}}function k(l,a){1&l&&(t.TgZ(0,"span",42),t._UZ(1,"div",43),t.qZA())}function z(l,a){1&l&&(t.TgZ(0,"span",44),t._UZ(1,"div",43),t.qZA())}function X(l,a){if(1&l&&(t.TgZ(0,"div",45),t._uU(1),t.qZA()),2&l){const i=t.oxw().$implicit;t.xp6(1),t.hij(" Synonym: ",i.synonym," ")}}function q(l,a){if(1&l&&(t.TgZ(0,"div",46),t._uU(1),t.qZA()),2&l){const i=t.oxw().$implicit;t.xp6(1),t.hij(" Antonym: ",i.antonym," ")}}function nt(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"div",50)(1,"div",51),t.NdJ("dblclick",function(){t.CHM(i);const e=t.oxw(5);return t.KtG(e.clickOnWord())}),t.TgZ(2,"button",52),t.NdJ("click",function(e){const p=t.CHM(i).$implicit,C=t.oxw(2).$implicit,P=t.oxw(2).$implicit;return t.oxw().addExample(p,C,P),t.KtG(e.stopPropagation())}),t._UZ(3,"mat-icon",53),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA()(),t.TgZ(6,"div",54),t._uU(7),t.qZA()()}if(2&l){const i=a.$implicit;t.xp6(5),t.hij(" ",i.original," "),t.xp6(2),t.Oqu(i.translation)}}function ot(l,a){if(1&l&&(t.TgZ(0,"div",47)(1,"div",48),t.YNc(2,nt,8,2,"div",49),t.qZA()()),2&l){const i=t.oxw().$implicit;t.xp6(2),t.Q6J("ngForOf",i.examples)}}function tt(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"div",29),t.YNc(1,G,2,1,"div",30),t.TgZ(2,"div",31),t.NdJ("click",function(){const n=t.CHM(i).$implicit;return t.KtG(n.showDetails=!n.showDetails)}),t.TgZ(3,"span",32),t.NdJ("dblclick",function(){t.CHM(i);const e=t.oxw(3);return t.KtG(e.clickOnWord())}),t.YNc(4,Q,2,1,"span",33),t.YNc(5,k,2,0,"span",34),t.YNc(6,z,2,0,"span",35),t.TgZ(7,"span",36),t._uU(8),t.qZA()()(),t.YNc(9,X,2,1,"div",37),t.YNc(10,q,2,1,"div",38),t.YNc(11,ot,3,1,"div",39),t.qZA()}if(2&l){const i=a.$implicit;t.xp6(1),t.Q6J("ngIf",i.lexicalUnit),t.xp6(1),t.ekj("has-examples",i.examples),t.xp6(2),t.Q6J("ngIf",i.level),t.xp6(1),t.Q6J("ngIf",i.examples),t.xp6(1),t.Q6J("ngIf",!i.examples),t.xp6(2),t.hij(" ",i.definition," "),t.xp6(1),t.Q6J("ngIf",i.synonym),t.xp6(1),t.Q6J("ngIf",i.antonym),t.xp6(1),t.Q6J("ngIf",i.showDetails)}}function st(l,a){if(1&l){const i=t.EpF();t.ynx(0),t.TgZ(1,"div",22),t.YNc(2,$,2,1,"span",23),t.TgZ(3,"span",19),t.NdJ("click",function(){t.CHM(i);const e=t.oxw().$implicit,n=t.oxw();return t.KtG(n.selectPartOfSpeech(e.partOfSpeech))}),t._uU(4),t.qZA(),t.YNc(5,J,2,1,"span",24),t.qZA(),t.TgZ(6,"div",25),t.YNc(7,tt,12,10,"div",26),t.qZA(),t.BQk()}if(2&l){const i=t.oxw().$implicit,_=t.oxw();t.xp6(2),t.Q6J("ngIf",i.transcription),t.xp6(1),t.ekj("selected",_.selectedPartsOfSpeech.includes(i.partOfSpeech)),t.xp6(1),t.hij(" ",i.partOfSpeech," "),t.xp6(1),t.Q6J("ngIf",i.dictionaryName),t.xp6(2),t.Q6J("ngForOf",i.definitions)}}function W(l,a){if(1&l&&(t.TgZ(0,"div",21),t.YNc(1,st,8,6,"ng-container",12),t.qZA()),2&l){const i=a.$implicit,_=t.oxw();t.xp6(1),t.Q6J("ngIf",!_.selectedPartsOfSpeech.length||_.selectedPartsOfSpeech.includes(i.partOfSpeech))}}function et(l,a){if(1&l){const i=t.EpF();t.TgZ(0,"div",58),t.NdJ("dblclick",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.clickOnWord())}),t._uU(1),t.qZA()}if(2&l){const i=a.$implicit;t.xp6(1),t.hij(" ",i," ")}}function it(l,a){if(1&l&&(t.TgZ(0,"div",55)(1,"div",56),t._uU(2,"See also:"),t.qZA(),t.YNc(3,et,2,1,"div",57),t.qZA()),2&l){const i=t.oxw();t.xp6(3),t.Q6J("ngForOf",i.words)}}let R=((x=class{set term(a){this.dictionaryService.setTerm(a),this.searchControl.setValue(a,{emitEvent:!1})}constructor(a,i,_,e,n,p,C){this.favoriteWordsService=a,this.cdr=i,this.dictionaryService=_,this.favoriteExamplesService=e,this.localStorageService=n,this.info=p,this.ankiConnectService=C,this.newTermIsSet=new t.vpe,this.searchTerm="",this.dictionaryIsEmpty=!1,this.dictionaryTerm=null,this.partsOfSpeech=[],this.selectedPartsOfSpeech=[],this.words=[],this.termOptions=[],this.searchControl=new r.NI(""),this.favoriteWordStatus=null,this.useExternalId=this.localStorageService.useExternalId,this.tag=localStorage.getItem(M.wf)||"selected",this.ankiDeck=this.localStorageService.ankiDeck}selectPartOfSpeech(a){this.selectedPartsOfSpeech.includes(a)?this.selectedPartsOfSpeech=this.selectedPartsOfSpeech.filter(i=>i!==a):this.selectedPartsOfSpeech.push(a)}ngOnInit(){this.favoriteWordsService.check$.pipe((0,O.t)(this)).subscribe(a=>{this.favoriteWordStatus=a,this.cdr.detectChanges()}),this.dictionaryService.currentDictionaryState$.pipe((0,O.t)(this)).subscribe(a=>{this.searchTerm=a?.searchTerm||"",this.dictionaryTerm=a?.currentDictionaryTerm||null,this.dictionaryIsEmpty=!!a?.dictionaryIsEmpty,this.words=a?.seeAlsoWords||[],this.dictionaryTerm?.term&&(this.words=this.words.filter(i=>i!==this.dictionaryTerm?.term)),this.setTerm(this.dictionaryTerm)}),this.initSearchControl()}initSearchControl(){this.searchControl.valueChanges.subscribe(a=>{!a||a.length<this.dictionaryService.minimalSearchPattern?this.termOptions=[]:(this.termOptions=this.dictionaryService.searchTerms(a)||[],1===this.termOptions.length&&this.selectTermOption(this.termOptions[0]))})}paste(){navigator.clipboard.readText().then(a=>this.selectTermOption(a?.trim()||""),a=>console.error(a))}selectTermOption(a){this.dictionaryService.setTerm(a||""),this.termOptions=[],this.newTermIsSet.emit(a||"")}clickOnWord(){const a=(0,m.R)();this.searchControl.setValue(a,{emitEvent:!1}),this.dictionaryService.setTerm(a),this.newTermIsSet.emit(a)}markForAnki(a){const i=a.externalId;if(!i)return;let _="";this.ankiDeck&&(_+="deck:"+this.ankiDeck+" "),_+="id:"+i,this.ankiConnectService.findNotes(_).pipe((0,c.q)(1),(0,f.U)(e=>e.slice(0,M.KM))).subscribe(e=>{this.ankiConnectService.addTagForNotes(e.map(n=>n.noteId),this.tag)})}addExample(a,i,_){this.useExternalId&&a.externalId?this.markForAnki(a):this.favoriteExamplesService.addExample({definition:i.definition,original:a.original,translation:a.translation||"",synonym:i.synonym||"",antonym:i.antonym||"",level:i.level||"",partOfSpeech:_.partOfSpeech,term:this.dictionaryTerm?.term||"",transcription:_.transcription||""})}setTerm(a){if(this.selectedPartsOfSpeech=[],this.dictionaryTerm=a,!a)return this.partsOfSpeech=[],void this.cdr.detectChanges();const i=a.articles.map(_=>_.partOfSpeech?.toLowerCase()?.trim()||"").filter(_=>!!_);this.partsOfSpeech=[...new Set(i)],this.topMarker?.nativeElement?.scrollIntoView(),this.cdr.detectChanges()}}).\u0275fac=function(a){return new(a||x)(t.Y36(A.d),t.Y36(t.sBO),t.Y36(B.E),t.Y36(L.j),t.Y36(F.n),t.Y36(U.C),t.Y36(b.S))},x.\u0275cmp=t.Xpm({type:x,selectors:[["app-dictionary-widget"]],viewQuery:function(a,i){if(1&a&&t.Gf(I,5),2&a){let _;t.iGM(_=t.CRH())&&(i.topMarker=_.first)}},inputs:{term:"term"},outputs:{newTermIsSet:"newTermIsSet"},standalone:!0,features:[t.jDz],decls:19,vars:10,consts:[[1,"top-marker"],["topMarker",""],[1,"search-bar"],[1,"form-field"],[1,"mat-label"],["type","text","placeholder","Term","autocomplete","false","matInput","",3,"formControl","matAutocomplete","keyup.enter","keyup","keydown","paste"],["auto","matAutocomplete"],[3,"value","keyup.enter","click",4,"ngFor","ngForOf"],["class","empty-dictionary",4,"ngIf"],["class","parts-of-speech",4,"ngIf"],[1,"header"],["class","favorite-word-button","mat-icon-button","",3,"color","click",4,"ngIf"],[4,"ngIf"],["class","article",4,"ngFor","ngForOf"],["class","words",4,"ngIf"],[3,"value","keyup.enter","click"],[1,"empty-dictionary"],[1,"parts-of-speech"],["class","part-of-speech",3,"selected","click",4,"ngFor","ngForOf"],[1,"part-of-speech",3,"click"],["mat-icon-button","",1,"favorite-word-button",3,"color","click"],[1,"article"],[1,"article-header"],["class","transcription",4,"ngIf"],["class","dictionary",4,"ngIf"],[1,"definitions"],["class","definition",4,"ngFor","ngForOf"],[1,"transcription"],[1,"dictionary"],[1,"definition"],["class","lex-unit",4,"ngIf"],[1,"definition",3,"click"],[3,"dblclick"],["class","level",4,"ngIf"],["class","content-mark",4,"ngIf"],["class","non-content-mark",4,"ngIf"],[1,"def-text"],["class","synonym",4,"ngIf"],["class","antonym",4,"ngIf"],["class","details",4,"ngIf"],[1,"lex-unit"],[1,"level"],[1,"content-mark"],[1,"box"],[1,"non-content-mark"],[1,"synonym"],[1,"antonym"],[1,"details"],[1,"examples"],["class","example",4,"ngFor","ngForOf"],[1,"example"],[1,"original",3,"dblclick"],["mat-icon-button","","color","primary",3,"click"],["fontIcon","add",1,"icon"],[1,"translation"],[1,"words"],[1,"title"],["class","word",3,"dblclick",4,"ngFor","ngForOf"],[1,"word",3,"dblclick"]],template:function(a,i){if(1&a&&(t._UZ(0,"div",0,1),t.TgZ(2,"div",2)(3,"mat-form-field",3)(4,"mat-label",4),t._uU(5,"Term"),t.qZA(),t.TgZ(6,"input",5),t.NdJ("keyup.enter",function(){return i.selectTermOption(i.searchControl.value)})("keyup",function(e){return e.stopPropagation()})("keydown",function(e){return e.stopPropagation()})("paste",function(){return i.paste()}),t.qZA(),t.TgZ(7,"mat-autocomplete",null,6),t.YNc(9,K,2,2,"mat-option",7),t.qZA()()(),t.YNc(10,N,2,0,"div",8),t.YNc(11,Y,2,1,"div",9),t.TgZ(12,"div",10),t.YNc(13,H,3,1,"button",11),t.YNc(14,V,3,2,"span",12),t.TgZ(15,"span"),t._uU(16),t.qZA()(),t.YNc(17,W,2,1,"div",13),t.YNc(18,it,4,1,"div",14)),2&a){const _=t.MAs(8);let e;t.xp6(6),t.Q6J("formControl",i.searchControl)("matAutocomplete",_),t.xp6(3),t.Q6J("ngForOf",i.termOptions),t.xp6(1),t.Q6J("ngIf",i.dictionaryIsEmpty),t.xp6(1),t.Q6J("ngIf",(null==i.partsOfSpeech?null:i.partsOfSpeech.length)&&i.partsOfSpeech.length>1),t.xp6(2),t.Q6J("ngIf",null==i.dictionaryTerm?null:i.dictionaryTerm.term),t.xp6(1),t.Q6J("ngIf",i.searchTerm.trim().toLowerCase()!==(null==i.dictionaryTerm||null==i.dictionaryTerm.term||null==(e=i.dictionaryTerm.term.trim())?null:e.toLowerCase())),t.xp6(2),t.hij(" ",null==i.dictionaryTerm?null:i.dictionaryTerm.term," "),t.xp6(1),t.Q6J("ngForOf",null==i.dictionaryTerm?null:i.dictionaryTerm.articles),t.xp6(1),t.Q6J("ngIf",i.words.length)}},dependencies:[T.ez,T.sg,T.O5,u.ot,u.RK,y.Ps,y.Hw,r.u5,r.Fj,r.JJ,g.Bb,g.XC,d.ey,g.ZL,h.lN,h.KE,h.hX,v.c,v.Nt,d.Ng,r.UX,r.oH],styles:["[_nghost-%COMP%]{display:block;padding:var(--padding-main);font-size:var(--dictionary-main-font-size)}.parts-of-speech[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.parts-of-speech[_ngcontent-%COMP%]   .part-of-speech[_ngcontent-%COMP%]{cursor:pointer;margin:4px}.parts-of-speech[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{outline:1px solid green}.header[_ngcontent-%COMP%]{font-size:var(--dictionary-header-font-size);font-weight:700;display:flex;flex-wrap:wrap;align-items:center;gap:8px}.header[_ngcontent-%COMP%]   .favorite-word-button[_ngcontent-%COMP%]{padding:8px 0 0;margin-right:-8px}.header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1}.has-examples[_ngcontent-%COMP%]   .def-text[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]{margin:16px 0}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]{margin:var(--padding-main) 0;line-height:2}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#f9e79f}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .dictionary[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#94ff7d}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]{margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;background-color:wheat;height:12px;width:12px;transform:translateY(-2px)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{height:8px;width:8px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{background-color:green}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .lex-unit[_ngcontent-%COMP%]{font-weight:700;font-size:1.2em;background-color:wheat;color:#000;padding:2px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .level[_ngcontent-%COMP%]{color:green;font-weight:700;background-color:wheat;padding:2px;margin-right:4px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .synonym[_ngcontent-%COMP%]{color:green;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .antonym[_ngcontent-%COMP%]{color:red;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]{padding-left:var(--padding-small);margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]{display:flex;align-items:center}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:gray;padding-left:var(--padding-large)}.part-of-speech[_ngcontent-%COMP%]{font-weight:700;background-color:wheat;color:#000;padding:4px;margin:4px 0;cursor:pointer}.words[_ngcontent-%COMP%]{display:flex;gap:8px}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:center;gap:var(--padding-main);width:100%}.form-field[_ngcontent-%COMP%]{width:800px;max-width:90vw}.mat-label[_ngcontent-%COMP%]{color:gray!important}"],changeDetection:0}),x);R=(0,o.gn)([(0,O.c)()],R)},4861:(S,E,s)=>{s.d(E,{E:()=>r});var o=s(5619),t=s(2572),T=s(8180);function O(g,h){const v=h.index>=0?h.index:g.length+h.index;if(g.slice(v,v+h.pattern.length)!==h.pattern)return null;const d=g.length-(g.slice(0,h.index).length+h.pattern.length);let m=g.slice(0,h.index)+h.replace;return d>0&&(m+=g.slice(-1*d)),m}var u=s(5879),y=s(5071);let r=(()=>{class g{constructor(v){this.bookService=v,this.currentDictionaryState$=new o.X(null),this.minimalSearchPattern=2,this.maxNumberOfSearchResults=50,this.morphology={},this.morphologyReplaceRules=[],this.dictionaryIsEmpty=!0,this.morphologyIsEmpty=!0,this.searchTerm="",this.currentTerm="",this.terms=[],this.seeAlsoWords=[],(0,t.a)([this.bookService.getMorphology$(),this.bookService.getDictionaryTerms$(),this.bookService.getMorphologyReplaceRules$()]).pipe((0,T.q)(1)).subscribe(([d,m,c])=>{d?.morphology?(this.morphology=d.morphology,this.morphologyIsEmpty=!1):(this.morphology={},this.morphologyIsEmpty=!0),this.morphologyReplaceRules=c?.morphologyReplaceRules?c.morphologyReplaceRules:[],m.length?(this.terms=m,this.dictionaryIsEmpty=!1):this.dictionaryIsEmpty=!0,this.setDictionaryState(null),this.searchTerm&&this.setTerm(this.searchTerm)})}searchTerms(v){if(v.length<this.minimalSearchPattern)return null;const d=new RegExp(v.replaceAll("*",".+"),"iu");return this.terms.filter(m=>d.test(m)).slice(0,this.maxNumberOfSearchResults)}setTerm(v){if(this.searchTerm=v,this.currentTerm=v.trim().toLowerCase(),this.seeAlsoWords=[],this.setDictionaryState(null),this.morphologyReplaceRules.forEach(m=>{const c=O(this.currentTerm,m);c&&this.checkTerm(c)&&this.seeAlsoWords.push(c)}),!this.morphologyIsEmpty){const m=this.morphology[this.currentTerm];m?.o&&this.seeAlsoWords.push(m.o)}let d=this.checkTerm(this.currentTerm);if(d)this.setDictionaryState(d);else{if(!this.morphologyIsEmpty){const m=this.morphology[this.currentTerm];if(m?.o&&(d=this.checkTerm(m.o),d))return void this.setDictionaryState(d)}for(let m=0;m<this.morphologyReplaceRules.length;m++){const c=O(this.currentTerm,this.morphologyReplaceRules[m]);if(!c)continue;const f=this.checkTerm(c);if(f)return this.currentTerm=c,void this.setDictionaryState(f)}}}setDictionaryState(v){v?this.bookService.getDictionaryItem$(v).subscribe(d=>{this.currentDictionaryState$.next({currentDictionaryTerm:d,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}):this.setNullState()}setNullState(){this.seeAlsoWords=[],this.currentDictionaryState$.next({currentDictionaryTerm:null,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}checkTerm(v){return this.terms.includes(v)?v:""}}return g.\u0275fac=function(v){return new(v||g)(u.LFG(y.Z))},g.\u0275prov=u.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},3631:(S,E,s)=>{s.d(E,{j:()=>g});var o=s(5619),t=s(8180),T=s(2096),O=s(7772),u=s(5879),y=s(6280),r=s(957);let g=(()=>{class h{constructor(d,m){this.dbService=d,this.infoService=m,this.examples$=new o.X([]),this.sort=(c,f)=>(c.toDoTimestamp||0)-(f.toDoTimestamp||0),this.dbService.getAll(O.L.FavoriteExamples).pipe((0,t.q)(1)).subscribe(c=>{c.forEach(f=>f.showDetails=!1),c?(c.sort(this.sort),this.examples$.next(c)):this.examples$.next([])})}deleteAll(){return this.dbService.clear(O.L.FavoriteExamples)}import(d){const m=JSON.parse(d)?.favoriteExamples;if(!m?.length)return console.error("!examples?.length"),this.infoService.error("!examples?.length"),(0,T.of)([]);const c=this.examples$.value.map(M=>M.timestamp);function f(M){return c.includes(M)?f(M+1):M}return m.forEach(M=>{if(!M.timestamp){const A=f(Date.now());c.push(A),M.timestamp=A}}),this.dbService.bulkAdd(O.L.FavoriteExamples,m).pipe((0,t.q)(1))}addExample(d){const m=Date.now(),c={...d,timestamp:m,showDetails:!1};this.dbService.add(O.L.FavoriteExamples,c).pipe((0,t.q)(1)).subscribe();const f=[c,...this.examples$.value];this.examples$.next(f),this.infoService.show("added: "+d.original)}update(d){if(!d?.timestamp||!d.toDoTimestamp)return;const m=this.examples$.value,c=m.find(f=>f.timestamp===d.timestamp);c&&(c.toDoTimestamp=d.toDoTimestamp,c.updateTimestamp=Date.now(),this.dbService.update(O.L.FavoriteExamples,c).pipe((0,t.q)(1)).subscribe(),m.sort(this.sort),this.examples$.next(m))}removeExample(d){if(!d)return;this.dbService.delete(O.L.FavoriteExamples,d).pipe((0,t.q)(1)).subscribe();const m=this.examples$.value.filter(c=>c.timestamp!==d);this.examples$.next(m)}}return h.\u0275fac=function(d){return new(d||h)(u.LFG(y.ys),u.LFG(r.C))},h.\u0275prov=u.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8495:(S,E,s)=>{s.d(E,{S:()=>v});var o=s(6306),t=s(9397),T=s(8180),O=s(4664),u=s(7398),y=s(5879),r=s(9862),g=s(2969),h=s(957);let v=(()=>{class d{constructor(c,f,M){this.http=c,this.localStorageService=f,this.info=M,this.ankiHost=this.localStorageService.ankiHost}addTagForNotes(c,f){this.http.post(this.ankiHost,{action:"addTags",version:6,params:{notes:c,tags:f}}).pipe((0,o.K)(M=>{throw this.info.error("There is error with anki-connection"),M}),(0,t.b)(()=>this.info.show("Tag added to "+c.length+" items")),(0,T.q)(1)).subscribe()}findNotes(c){return this.http.post(this.ankiHost,{action:"findNotes",version:6,params:{query:c}}).pipe((0,o.K)(f=>{throw this.info.error("There is error with anki-connection"),f}),(0,t.b)(f=>{f?.error&&this.info.error("Anki findNotes error")}),(0,O.w)(f=>this.http.post(this.ankiHost,{action:"notesInfo",version:6,params:{notes:f.result}}).pipe((0,t.b)(M=>{M?.error&&this.info.error("Anki findCards error")}),(0,u.U)(M=>M.result))))}}return d.\u0275fac=function(c){return new(c||d)(y.LFG(r.eN),y.LFG(g.n),y.LFG(h.C))},d.\u0275prov=y.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},5591:(S,E,s)=>{s.d(E,{d:()=>v});var o=s(5619),t=s(4664),T=s(7398),O=s(8180),u=s(2096),y=s(7772),r=s(5879),g=s(6280),h=s(4861);let v=(()=>{class d{constructor(c,f){this.dbService=c,this.dictionaryService=f,this.check$=new o.X(null),this.dictionaryService.currentDictionaryState$.pipe((0,t.w)(M=>this.getWordFromDB(M?.currentDictionaryTerm?.term||""))).subscribe(M=>{this.check$.next(M)})}importWords(c){return this.dbService.bulkAdd(y.L.FavoriteWords,c.map(f=>({term:f,v:1})))}getAll(){return this.dbService.getAll(y.L.FavoriteWords).pipe((0,T.U)(c=>c.map(f=>f.term)),(0,O.q)(1))}switchCurrent(){const c=this.check$.value,f=c?.term,M=c?.status;f&&(M?this.remove(f):this.add(f),this.check$.next({term:f,status:!M}))}add(c){this.dbService.add(y.L.FavoriteWords,{term:c,v:"1"}).pipe((0,O.q)(1)).subscribe()}remove(c){this.dbService.delete(y.L.FavoriteWords,c).pipe((0,O.q)(1)).subscribe()}deleteAll(){this.dbService.clear(y.L.FavoriteWords).pipe((0,O.q)(1)).subscribe()}getWordFromDB(c){return c?this.dbService.getByID(y.L.FavoriteWords,c).pipe((0,T.U)(f=>({term:c,status:!!f}))):(0,u.of)({term:"",status:!1})}}return d.\u0275fac=function(c){return new(c||d)(r.LFG(g.ys),r.LFG(h.E))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},2969:(S,E,s)=>{s.d(E,{n:()=>O});var o=function(u){return u.CurrentPopupMenuTab="CurrentPopupMenuTab",u.CopyToClipboard="CopyToClipboard",u.UseExternalId="UseExternalId",u.ShowDictionary="ShowDictionary",u.HideMarkedHeaders="HideMarkedHeaders",u.ShowTranslationInBook="ShowTranslationInBook",u.AutoTranslateSelected="AutoTranslateSelected",u.ShowTranslatorInDictionaryViewer="ShowTranslatorInDictionaryViewer",u.AudioVoiceURI="AudioVoiceURI",u.AudioVolume="AudioVolume",u.AudioRate="AudioRate",u.AnkiDeck="AnkiDeck",u.AnkiHost="AnkiHost",u}(o||{}),t=s(2945),T=s(5879);let O=(()=>{class u{get ankiHost(){return localStorage.getItem(o.AnkiHost)||t.s7}set ankiHost(r){localStorage.setItem(o.AnkiHost,r||"")}get ankiDeck(){return localStorage.getItem(o.AnkiDeck)||""}set ankiDeck(r){localStorage.setItem(o.AnkiDeck,r||"")}get audioVoiceURI(){return localStorage.getItem(o.AudioVoiceURI)||""}set audioVoiceURI(r){localStorage.setItem(o.AudioVoiceURI,r||"")}get audioVolume(){return this.getNumber(o.AudioVolume,1)}set audioVolume(r){this.setNumber(o.AudioVolume,0===r?0:r||1)}get audioRate(){return this.getNumber(o.AudioRate,1)}set audioRate(r){this.setNumber(o.AudioRate,0===r?0:r||1)}get hideMarkedHeaders(){return this.getBoolean(o.HideMarkedHeaders,!1)}set hideMarkedHeaders(r){this.setBoolean(o.HideMarkedHeaders,r)}get copyToClipboard(){return this.getBoolean(o.CopyToClipboard,!1)}set copyToClipboard(r){this.setBoolean(o.CopyToClipboard,r)}get useExternalId(){return this.getBoolean(o.UseExternalId,!1)}set useExternalId(r){this.setBoolean(o.UseExternalId,r)}get showDictionary(){return this.getBoolean(o.ShowDictionary,!0)}set showDictionary(r){this.setBoolean(o.ShowDictionary,r)}get showTranslationInBook(){return this.getBoolean(o.ShowTranslationInBook,!0)}set showTranslationInBook(r){this.setBoolean(o.ShowTranslationInBook,r)}get currentPopupMenuTab(){return this.getNumber(o.CurrentPopupMenuTab)}set currentPopupMenuTab(r){this.setNumber(o.CurrentPopupMenuTab,r||0)}constructor(){this.trueString="true",this.falseString="false"}getString(r,g=""){return localStorage.getItem(r)||g}setString(r,g){localStorage.setItem(r,g)}setNumber(r,g){localStorage.setItem(r,String(g||0))}getNumber(r,g=0){const h=localStorage.getItem(r);if(null===h)return g;const v=+h;return Number.isNaN(v)?g:v}setBoolean(r,g){localStorage.setItem(r,g?this.trueString:this.falseString)}getBoolean(r,g=!1){const h=localStorage.getItem(r);return h===this.trueString||h!==this.falseString&&g}}return u.\u0275fac=function(r){return new(r||u)},u.\u0275prov=T.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},8299:(S,E,s)=>{s.d(E,{R:()=>T});const t=["\u2018","\u201c"," ",".",",","!","?",":",";","\t","\n","\r","'","`","\u2019",'"',"\\","/","[","]","(",")","{","}","-","\u2014","<",">"];function T(){const O=window.getSelection();if(!O)return"";const u=O.toString().trim();if(u)return u;const y=O.focusOffset,r=O.focusNode?.nodeValue;if(!r)return"";const g=r.split("");let h=function o(O,u,y){let r=u;for(;r--;)if(y(O[r],r,O))return r;return-1}(g,y,d=>t.includes(d));h=-1===h?0:h+1;let v=g.findIndex((d,m)=>t.includes(d)&&m>y);return-1===v&&(v=r.length),r.slice(h,v).trim()}},4630:(S,E,s)=>{s.d(E,{Bb:()=>a,XC:()=>q,ZL:()=>l});var o=s(5879),t=s(3680),T=s(6814),O=s(799),u=s(3651),y=s(4300),r=s(2495),g=s(2831),h=s(6825),v=s(7394),d=s(8645),m=s(4911),c=s(3019),f=s(2096),M=s(2438),A=s(6028),B=s(8484),L=s(6223),F=s(9157),U=s(7921),b=s(4664),x=s(8180),I=s(2181),K=s(7398),N=s(9397),Z=s(5177),Y=s(9388);const H=["panel"];function j(i,_){if(1&i&&(o.TgZ(0,"div",0,1),o.Hsn(2),o.qZA()),2&i){const e=_.id,n=o.oxw();o.Q6J("id",n.id)("ngClass",n._classList)("@panelAnimation",n.isOpen?"visible":"hidden"),o.uIk("aria-label",n.ariaLabel||null)("aria-labelledby",n._getPanelAriaLabelledby(e))}}const V=["*"],$=(0,h.X$)("panelAnimation",[(0,h.SB)("void, hidden",(0,h.oB)({opacity:0,transform:"scaleY(0.8)"})),(0,h.eR)(":enter, hidden => visible",[(0,h.ru)([(0,h.jt)("0.03s linear",(0,h.oB)({opacity:1})),(0,h.jt)("0.12s cubic-bezier(0, 0, 0.2, 1)",(0,h.oB)({transform:"scaleY(1)"}))])]),(0,h.eR)(":leave, visible => hidden",[(0,h.jt)("0.075s linear",(0,h.oB)({opacity:0}))])]);let J=0;class G{constructor(_,e){this.source=_,this.option=e}}const Q=(0,t.Kr)(class{}),k=new o.OlP("mat-autocomplete-default-options",{providedIn:"root",factory:function z(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1}}});let X=(()=>{class i extends Q{get isOpen(){return this._isOpen&&this.showPanel}_setColor(e){this._color=e,this._setThemeClasses(this._classList)}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=(0,r.Ig)(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=(0,r.Ig)(e)}set classList(e){this._classList=e&&e.length?(0,r.du)(e).reduce((n,p)=>(n[p]=!0,n),{}):{},this._setVisibilityClasses(this._classList),this._setThemeClasses(this._classList),this._elementRef.nativeElement.className=""}constructor(e,n,p,C){super(),this._changeDetectorRef=e,this._elementRef=n,this._defaults=p,this._activeOptionChanges=v.w0.EMPTY,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new o.vpe,this.opened=new o.vpe,this.closed=new o.vpe,this.optionActivated=new o.vpe,this._classList={},this.id="mat-autocomplete-"+J++,this.inertGroups=C?.SAFARI||!1,this._autoActiveFirstOption=!!p.autoActiveFirstOption,this._autoSelectActiveOption=!!p.autoSelectActiveOption}ngAfterContentInit(){this._keyManager=new y.s1(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const n=new G(this,e);this.optionSelected.emit(n)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}_setThemeClasses(e){e["mat-primary"]="primary"===this._color,e["mat-warn"]="warn"===this._color,e["mat-accent"]="accent"===this._color}_skipPredicate(e){return e.disabled}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(o.sBO),o.Y36(o.SBq),o.Y36(k),o.Y36(g.t4))},i.\u0275dir=o.lG2({type:i,viewQuery:function(e,n){if(1&e&&(o.Gf(o.Rgc,7),o.Gf(H,5)),2&e){let p;o.iGM(p=o.CRH())&&(n.template=p.first),o.iGM(p=o.CRH())&&(n.panel=p.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},features:[o.qOj]}),i})(),q=(()=>{class i extends X{constructor(){super(...arguments),this._visibleClass="mat-mdc-autocomplete-visible",this._hiddenClass="mat-mdc-autocomplete-hidden",this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=(0,r.Ig)(e),this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const e of this.options)e._changeDetectorRef.markForCheck()}_skipPredicate(e){return!1}}return i.\u0275fac=function(){let _;return function(n){return(_||(_=o.n5z(i)))(n||i)}}(),i.\u0275cmp=o.Xpm({type:i,selectors:[["mat-autocomplete"]],contentQueries:function(e,n,p){if(1&e&&(o.Suo(p,t.K7,5),o.Suo(p,t.ey,5)),2&e){let C;o.iGM(C=o.CRH())&&(n.optionGroups=C),o.iGM(C=o.CRH())&&(n.options=C)}},hostAttrs:["ngSkipHydration","",1,"mat-mdc-autocomplete"],inputs:{disableRipple:"disableRipple",hideSingleSelectionIndicator:"hideSingleSelectionIndicator"},exportAs:["matAutocomplete"],features:[o._Bn([{provide:t.HF,useExisting:i}]),o.qOj],ngContentSelectors:V,decls:1,vars:0,consts:[["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id","ngClass"],["panel",""]],template:function(e,n){1&e&&(o.F$t(),o.YNc(0,j,3,5,"ng-template"))},dependencies:[T.mk],styles:["div.mat-mdc-autocomplete-panel{box-shadow:0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12);width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-autocomplete-background-color)}.cdk-high-contrast-active div.mat-mdc-autocomplete-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden}mat-autocomplete{display:none}"],encapsulation:2,data:{animation:[$]},changeDetection:0}),i})();const tt={provide:L.JU,useExisting:(0,o.Gpc)(()=>l),multi:!0},W=new o.OlP("mat-autocomplete-scroll-strategy"),it={provide:W,deps:[u.aV],useFactory:function et(i){return()=>i.scrollStrategies.reposition()}};let R=(()=>{class i{get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=(0,r.Ig)(e)}constructor(e,n,p,C,P,w,at,rt,lt,ct,_t){this._element=e,this._overlay=n,this._viewContainerRef=p,this._zone=C,this._changeDetectorRef=P,this._dir=at,this._formField=rt,this._document=lt,this._viewportRuler=ct,this._defaults=_t,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=v.w0.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new d.x,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._overlayAttached=!1,this.optionSelections=(0,m.P)(()=>{const D=this.autocomplete?this.autocomplete.options:null;return D?D.changes.pipe((0,U.O)(D),(0,b.w)(()=>(0,c.T)(...D.map(pt=>pt.onSelectionChange)))):this._zone.onStable.pipe((0,x.q)(1),(0,b.w)(()=>this.optionSelections))}),this._handlePanelKeydown=D=>{(D.keyCode===A.hY&&!(0,A.Vb)(D)||D.keyCode===A.LH&&(0,A.Vb)(D,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),D.stopPropagation(),D.preventDefault())},this._trackedModal=null,this._scrollStrategy=w}ngAfterViewInit(){const e=this._getWindow();typeof e<"u"&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();typeof e<"u"&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay(),this._floatLabel()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return(0,c.T)(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe((0,I.h)(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe((0,I.h)(()=>this._overlayAttached)):(0,f.of)()).pipe((0,K.U)(e=>e instanceof t.rN?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return(0,c.T)((0,M.R)(this._document,"click"),(0,M.R)(this._document,"auxclick"),(0,M.R)(this._document,"touchend")).pipe((0,I.h)(e=>{const n=(0,g.sA)(e),p=this._formField?this._formField._elementRef.nativeElement:null,C=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&n!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!p||!p.contains(n))&&(!C||!C.contains(n))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(n)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const n=e.keyCode,p=(0,A.Vb)(e);if(n===A.hY&&!p&&e.preventDefault(),this.activeOption&&n===A.K5&&this.panelOpen&&!p)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const C=this.autocomplete._keyManager.activeItem,P=n===A.LH||n===A.JH;n===A.Mf||P&&!p&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):P&&this._canOpen()&&this.openPanel(),(P||this.autocomplete._keyManager.activeItem!==C)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let n=e.target,p=n.value;"number"===n.type&&(p=""==p?null:parseFloat(p)),this._previousValue!==p&&(this._previousValue=p,this._pendingAutoselectedOption=null,this._onChange(p),p||this._clearPreviousSelectedOption(null,!1),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_floatLabel(e=!1){this._formField&&"auto"===this._formField.floatLabel&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){const e=this._zone.onStable.pipe((0,x.q)(1)),n=this.autocomplete.options.changes.pipe((0,N.b)(()=>this._positionStrategy.reapplyLastPosition()),(0,Z.g)(0));return(0,c.T)(e,n).pipe((0,b.w)(()=>(this._zone.run(()=>{const p=this.panelOpen;this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),p!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),(0,x.q)(1)).subscribe(p=>this._setValueAndClose(p))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const n=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(n??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){const n=e?e.source:this._pendingAutoselectedOption;n&&(this._clearPreviousSelectedOption(n),this._assignOptionValue(n.value),this._onChange(n.value),this.autocomplete._emitSelectEvent(n),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e,n){this.autocomplete&&this.autocomplete.options&&this.autocomplete.options.forEach(p=>{p!==e&&p.selected&&p.deselect(n)})}_attachOverlay(){let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new B.UE(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const n=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&n!==this.panelOpen&&this.autocomplete.opened.emit()}_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){const e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new u.X_({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const n=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],p=this._aboveClass,C=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:p},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:p}];let P;P="above"===this.position?C:"below"===this.position?n:[...n,...C],e.withPositions(P)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;if(e.autoActiveFirstOption){let n=-1;for(let p=0;p<e.options.length;p++)if(!e.options.get(p).disabled){n=p;break}e._keyManager.setActiveItem(n)}else e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this._autocompleteDisabled}_getWindow(){return this._document?.defaultView||window}_scrollToOption(e){const n=this.autocomplete,p=(0,t.CB)(e,n.options,n.optionGroups);if(0===e&&1===p)n._setScrollTop(0);else if(n.panel){const C=n.options.toArray()[e];if(C){const P=C._getHostElement(),w=(0,t.jH)(P.offsetTop,P.offsetHeight,n._getScrollTop(),n.panel.nativeElement.offsetHeight);n._setScrollTop(w)}}}_applyModalPanelOwnership(){const e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;const n=this.autocomplete.id;this._trackedModal&&(0,y.iD)(this._trackedModal,"aria-owns",n),(0,y.Zf)(e,"aria-owns",n),this._trackedModal=e}_clearFromModal(){this._trackedModal&&((0,y.iD)(this._trackedModal,"aria-owns",this.autocomplete.id),this._trackedModal=null)}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(o.SBq),o.Y36(u.aV),o.Y36(o.s_b),o.Y36(o.R0b),o.Y36(o.sBO),o.Y36(W),o.Y36(Y.Is,8),o.Y36(F.G_,9),o.Y36(T.K0,8),o.Y36(O.rL),o.Y36(k,8))},i.\u0275dir=o.lG2({type:i,inputs:{autocomplete:["matAutocomplete","autocomplete"],position:["matAutocompletePosition","position"],connectedTo:["matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["matAutocompleteDisabled","autocompleteDisabled"]},features:[o.TTD]}),i})(),l=(()=>{class i extends R{constructor(){super(...arguments),this._aboveClass="mat-mdc-autocomplete-panel-above"}}return i.\u0275fac=function(){let _;return function(n){return(_||(_=o.n5z(i)))(n||i)}}(),i.\u0275dir=o.lG2({type:i,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(e,n){1&e&&o.NdJ("focusin",function(){return n._handleFocus()})("blur",function(){return n._onTouched()})("input",function(C){return n._handleInput(C)})("keydown",function(C){return n._handleKeydown(C)})("click",function(){return n._handleClick()}),2&e&&o.uIk("autocomplete",n.autocompleteAttribute)("role",n.autocompleteDisabled?null:"combobox")("aria-autocomplete",n.autocompleteDisabled?null:"list")("aria-activedescendant",n.panelOpen&&n.activeOption?n.activeOption.id:null)("aria-expanded",n.autocompleteDisabled?null:n.panelOpen.toString())("aria-controls",n.autocompleteDisabled||!n.panelOpen||null==n.autocomplete?null:n.autocomplete.id)("aria-haspopup",n.autocompleteDisabled?null:"listbox")},exportAs:["matAutocompleteTrigger"],features:[o._Bn([tt]),o.qOj]}),i})(),a=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({providers:[it],imports:[u.U8,t.Ng,t.BQ,T.ez,O.ZD,t.Ng,t.BQ]}),i})()}}]);