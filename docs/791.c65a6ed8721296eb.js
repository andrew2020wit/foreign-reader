"use strict";(self.webpackChunkforeign_reader=self.webpackChunkforeign_reader||[]).push([[791],{1177:(S,M,s)=>{s.d(M,{LH:()=>O,Ot:()=>t,Zt:()=>f,jk:()=>o});const o="http://127.0.0.1:8765",t=500,O="ankiTag",f="ankiRequestText"},9791:(S,M,s)=>{s.d(M,{G:()=>T});var o=s(1635),t=s(4438),O=s(5256),f=s(8834),y=s(9213),m=s(9417),v=s(850),_=s(882),g=s(9631),a=s(6600),l=s(3716),h=s(6697),c=s(6354),d=s(1177),u=s(280),D=s(3609),w=s(7251),B=s(1502),U=s(9530),I=s(16);const A=["topMarker"];function b(e,n){if(1&e){const i=t.RV6();t.j41(0,"mat-option",14),t.bIt("keyup.enter",function(){const p=t.eBV(i).$implicit,E=t.XpG(2);return t.Njj(E.selectTermOption(p))})("click",function(){const p=t.eBV(i).$implicit,E=t.XpG(2);return t.Njj(E.selectTermOption(p))}),t.EFF(1),t.k0s()}if(2&e){const i=n.$implicit;t.Y8G("value",i),t.R7$(),t.SpI(" ",i," ")}}function L(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",3)(1,"mat-form-field",10)(2,"mat-label",11),t.EFF(3,"Term"),t.k0s(),t.j41(4,"input",12),t.bIt("keyup.enter",function(){t.eBV(i);const p=t.XpG();return t.Njj(p.selectTermOption(p.searchControl.value))})("keyup",function(p){return t.eBV(i),t.Njj(p.stopPropagation())})("keydown",function(p){return t.eBV(i),t.Njj(p.stopPropagation())})("paste",function(){t.eBV(i);const p=t.XpG();return t.Njj(p.paste())}),t.k0s(),t.j41(5,"mat-autocomplete",null,1),t.Z7z(7,b,2,2,"mat-option",13,t.fX1),t.k0s()()()}if(2&e){const i=t.sdS(6),r=t.XpG();t.R7$(4),t.Y8G("formControl",r.searchControl)("matAutocomplete",i),t.R7$(3),t.Dyx(r.termOptions)}}function j(e,n){1&e&&(t.j41(0,"div",4),t.EFF(1," dictionaryIsEmpty "),t.k0s())}function K(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",16),t.bIt("click",function(){const p=t.eBV(i).$implicit,E=t.XpG(2);return t.Njj(E.selectPartOfSpeech(p))}),t.EFF(1),t.k0s()}if(2&e){const i=n.$implicit,r=t.XpG(2);t.AVh("selected",r.selectedPartsOfSpeech.includes(i)),t.R7$(),t.SpI(" ",i," ")}}function $(e,n){if(1&e&&(t.j41(0,"div",5),t.Z7z(1,K,2,3,"div",15,t.fX1),t.k0s()),2&e){const i=t.XpG();t.R7$(),t.Dyx(i.partsOfSpeech)}}function V(e,n){if(1&e){const i=t.RV6();t.j41(0,"button",17),t.bIt("click",function(){t.eBV(i);const p=t.XpG();return t.Njj(p.favoriteWordsService.switchCurrent())}),t.j41(1,"mat-icon"),t.EFF(2,"star"),t.k0s()()}if(2&e){const i=t.XpG();t.Y8G("color",null!=i.favoriteWordStatus&&i.favoriteWordStatus.status?"accent":"primary")}}function N(e,n){1&e&&t.EFF(0," => ")}function X(e,n){if(1&e&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,N,1,0),t.k0s()),2&e){const i=t.XpG();t.R7$(),t.SpI(" ",i.searchTerm," "),t.R7$(),t.vxM(2,null!=i.dictionaryTerm&&i.dictionaryTerm.term?2:-1)}}function H(e,n){if(1&e&&(t.j41(0,"span",19),t.EFF(1),t.k0s()),2&e){const i=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",i.transcription," ")}}function G(e,n){if(1&e&&(t.j41(0,"span",20),t.EFF(1),t.k0s()),2&e){const i=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",i.dictionaryName," ")}}function Y(e,n){if(1&e&&(t.j41(0,"div",23),t.EFF(1),t.k0s()),2&e){const i=t.XpG().$implicit;t.R7$(),t.SpI(" ",i.lexicalUnit," ")}}function k(e,n){if(1&e&&(t.j41(0,"span",26),t.EFF(1),t.k0s()),2&e){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.level)}}function z(e,n){1&e&&(t.j41(0,"span",27),t.nrm(1,"div",33),t.k0s())}function Q(e,n){1&e&&(t.j41(0,"span",28),t.nrm(1,"div",33),t.k0s())}function it(e,n){if(1&e&&(t.j41(0,"div",30),t.EFF(1),t.k0s()),2&e){const i=t.XpG().$implicit;t.R7$(),t.SpI(" Synonym: ",i.synonym," ")}}function J(e,n){if(1&e&&(t.j41(0,"div",31),t.EFF(1),t.k0s()),2&e){const i=t.XpG().$implicit;t.R7$(),t.SpI(" Antonym: ",i.antonym," ")}}function nt(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",35)(1,"div",36),t.bIt("dblclick",function(){t.eBV(i);const p=t.XpG(5);return t.Njj(p.clickOnWord())}),t.j41(2,"button",37),t.bIt("click",function(p){const E=t.eBV(i).$implicit,R=t.XpG(2).$implicit,x=t.XpG(2).$implicit;return t.XpG().addExample(E,R,x),t.Njj(p.stopPropagation())}),t.nrm(3,"mat-icon",38),t.k0s(),t.j41(4,"span"),t.EFF(5),t.k0s()(),t.j41(6,"div",39),t.EFF(7),t.k0s()()}if(2&e){const i=n.$implicit;t.R7$(2),t.Y8G("color",i.externalId?"accent":"primary"),t.R7$(3),t.SpI(" ",i.original," "),t.R7$(2),t.JRh(i.translation)}}function F(e,n){if(1&e&&(t.j41(0,"div",32)(1,"div",34),t.Z7z(2,nt,8,3,"div",35,t.fX1),t.k0s()()),2&e){const i=t.XpG().$implicit;t.R7$(2),t.Dyx(i.examples)}}function Z(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",22),t.DNE(1,Y,2,1,"div",23),t.j41(2,"div",24),t.bIt("click",function(){const p=t.eBV(i).$implicit;return t.Njj(p.showDetails=!p.showDetails)}),t.j41(3,"span",25),t.bIt("dblclick",function(){t.eBV(i);const p=t.XpG(3);return t.Njj(p.clickOnWord())}),t.DNE(4,k,2,1,"span",26)(5,z,2,0,"span",27)(6,Q,2,0,"span",28),t.j41(7,"span",29),t.EFF(8),t.k0s()()(),t.DNE(9,it,2,1,"div",30)(10,J,2,1,"div",31)(11,F,4,0,"div",32),t.k0s()}if(2&e){const i=n.$implicit;t.R7$(),t.vxM(1,i.lexicalUnit?1:-1),t.R7$(),t.AVh("has-examples",i.examples),t.R7$(2),t.vxM(4,i.level?4:-1),t.R7$(),t.vxM(5,i.examples?5:-1),t.R7$(),t.vxM(6,i.examples?-1:6),t.R7$(2),t.SpI(" ",i.definition," "),t.R7$(),t.vxM(9,i.synonym?9:-1),t.R7$(),t.vxM(10,i.antonym?10:-1),t.R7$(),t.vxM(11,i.showDetails?11:-1)}}function q(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",18),t.DNE(1,H,2,1,"span",19),t.j41(2,"span",16),t.bIt("click",function(){t.eBV(i);const p=t.XpG().$implicit,E=t.XpG();return t.Njj(E.selectPartOfSpeech(p.partOfSpeech))}),t.EFF(3),t.k0s(),t.DNE(4,G,2,1,"span",20),t.k0s(),t.j41(5,"div",21),t.Z7z(6,Z,12,10,"div",22,t.fX1),t.k0s()}if(2&e){const i=t.XpG().$implicit,r=t.XpG();t.R7$(),t.vxM(1,i.transcription?1:-1),t.R7$(),t.AVh("selected",r.selectedPartsOfSpeech.includes(i.partOfSpeech)),t.R7$(),t.SpI(" ",i.partOfSpeech," "),t.R7$(),t.vxM(4,i.dictionaryName?4:-1),t.R7$(2),t.Dyx(i.definitions)}}function W(e,n){if(1&e&&(t.j41(0,"div",8),t.DNE(1,q,8,5),t.k0s()),2&e){const i=n.$implicit,r=t.XpG();t.R7$(),t.vxM(1,!r.selectedPartsOfSpeech.length||r.selectedPartsOfSpeech.includes(i.partOfSpeech)?1:-1)}}function tt(e,n){if(1&e){const i=t.RV6();t.j41(0,"div",42),t.bIt("dblclick",function(){t.eBV(i);const p=t.XpG(2);return t.Njj(p.clickOnWord())}),t.EFF(1),t.k0s()}if(2&e){const i=n.$implicit;t.R7$(),t.SpI(" ",i," ")}}function C(e,n){if(1&e&&(t.j41(0,"div",9)(1,"div",40),t.EFF(2,"See also:"),t.k0s(),t.Z7z(3,tt,2,1,"div",41,t.fX1),t.k0s()),2&e){const i=t.XpG();t.R7$(3),t.Dyx(i.words)}}let T=class et{set term(n){this.dictionaryService.setTerm(n),this.searchControl.setValue(n,{emitEvent:!1})}constructor(n,i,r,p,E,R,x){this.favoriteWordsService=n,this.cdr=i,this.dictionaryService=r,this.favoriteExamplesService=p,this.localStorageService=E,this.info=R,this.ankiConnectService=x,this.hideSearchBar=!1,this.newTermIsSet=new t.bkB,this.searchTerm="",this.dictionaryIsEmpty=!1,this.dictionaryTerm=null,this.partsOfSpeech=[],this.selectedPartsOfSpeech=[],this.words=[],this.termOptions=[],this.searchControl=new m.MJ(""),this.favoriteWordStatus=null,this.useExternalId=this.localStorageService.useExternalId,this.tag=localStorage.getItem(d.LH)||"selected",this.ankiDeck=this.localStorageService.ankiDeck}selectPartOfSpeech(n){this.selectedPartsOfSpeech.includes(n)?this.selectedPartsOfSpeech=this.selectedPartsOfSpeech.filter(i=>i!==n):this.selectedPartsOfSpeech.push(n)}ngOnInit(){this.favoriteWordsService.check$.pipe((0,O.s)(this)).subscribe(n=>{this.favoriteWordStatus=n,this.cdr.detectChanges()}),this.dictionaryService.currentDictionaryState$.pipe((0,O.s)(this)).subscribe(n=>{this.searchTerm=n?.searchTerm||"",this.dictionaryTerm=n?.currentDictionaryTerm||null,this.dictionaryIsEmpty=!!n?.dictionaryIsEmpty,this.words=n?.seeAlsoWords||[],this.dictionaryTerm?.term&&(this.words=this.words.filter(i=>i!==this.dictionaryTerm?.term)),this.setTerm(this.dictionaryTerm)}),this.initSearchControl()}initSearchControl(){this.searchControl.valueChanges.subscribe(n=>{!n||n.length<this.dictionaryService.minimalSearchPattern?this.termOptions=[]:(this.termOptions=this.dictionaryService.searchTerms(n)||[],1===this.termOptions.length&&this.selectTermOption(this.termOptions[0]))})}paste(){navigator.clipboard.readText().then(n=>this.selectTermOption(n?.trim()||""),n=>console.error(n))}selectTermOption(n){this.dictionaryService.setTerm(n||""),this.termOptions=[],this.newTermIsSet.emit(n||"")}clickOnWord(){const n=(0,l.T)();this.searchControl.setValue(n,{emitEvent:!1}),this.dictionaryService.setTerm(n),this.newTermIsSet.emit(n)}markForAnki(n){const i=n.externalId;i&&this.ankiConnectService.findCards("id:"+i).pipe((0,h.s)(1),(0,c.T)(p=>p.slice(0,d.Ot))).subscribe(p=>{this.ankiConnectService.markCards(p.map(E=>E.cardId))})}addExample(n,i,r){this.useExternalId&&n.externalId?this.markForAnki(n):this.favoriteExamplesService.addExample({definition:i.definition,original:n.original,translation:n.translation||"",synonym:i.synonym||"",antonym:i.antonym||"",level:i.level||"",partOfSpeech:r.partOfSpeech,term:this.dictionaryTerm?.term||"",transcription:r.transcription||""})}setTerm(n){if(this.selectedPartsOfSpeech=[],this.dictionaryTerm=n,!n)return this.partsOfSpeech=[],void this.cdr.detectChanges();const i=n.articles.map(r=>r.partOfSpeech?.toLowerCase()?.trim()||"").filter(r=>!!r);this.partsOfSpeech=[...new Set(i)],this.topMarker?.nativeElement?.scrollIntoView(),this.cdr.detectChanges()}static{this.\u0275fac=function(i){return new(i||et)(t.rXU(u.b),t.rXU(t.gRc),t.rXU(D.K),t.rXU(w.f),t.rXU(B.s),t.rXU(U.O),t.rXU(I.b))}}static{this.\u0275cmp=t.VBU({type:et,selectors:[["app-dictionary-widget"]],viewQuery:function(i,r){if(1&i&&t.GBs(A,5),2&i){let p;t.mGM(p=t.lsd())&&(r.topMarker=p.first)}},inputs:{term:"term",hideSearchBar:"hideSearchBar"},outputs:{newTermIsSet:"newTermIsSet"},standalone:!0,features:[t.aNF],decls:13,vars:7,consts:[["topMarker",""],["auto","matAutocomplete"],[1,"top-marker"],[1,"search-bar"],[1,"empty-dictionary"],[1,"parts-of-speech"],[1,"header"],["mat-icon-button","",1,"favorite-word-button",3,"color"],[1,"article"],[1,"words"],[1,"form-field"],[1,"mat-label"],["type","text","placeholder","Term","autocomplete","false","matInput","",3,"keyup.enter","keyup","keydown","paste","formControl","matAutocomplete"],[3,"value"],[3,"keyup.enter","click","value"],[1,"part-of-speech",3,"selected"],[1,"part-of-speech",3,"click"],["mat-icon-button","",1,"favorite-word-button",3,"click","color"],[1,"article-header"],[1,"transcription"],[1,"dictionary"],[1,"definitions"],[1,"definition"],[1,"lex-unit"],[1,"definition",3,"click"],[3,"dblclick"],[1,"level"],[1,"content-mark"],[1,"non-content-mark"],[1,"def-text"],[1,"synonym"],[1,"antonym"],[1,"details"],[1,"box"],[1,"examples"],[1,"example"],[1,"original",3,"dblclick"],["mat-icon-button","",3,"click","color"],["fontIcon","add",1,"icon"],[1,"translation"],[1,"title"],[1,"word"],[1,"word",3,"dblclick"]],template:function(i,r){if(1&i&&(t.nrm(0,"div",2,0),t.DNE(2,L,9,2,"div",3)(3,j,2,0,"div",4)(4,$,3,0,"div",5),t.j41(5,"div",6),t.DNE(6,V,3,1,"button",7)(7,X,3,2,"span"),t.j41(8,"span"),t.EFF(9),t.k0s()(),t.Z7z(10,W,2,1,"div",8,t.fX1),t.DNE(12,C,5,0,"div",9)),2&i){let p;t.R7$(2),t.vxM(2,r.hideSearchBar?-1:2),t.R7$(),t.vxM(3,r.dictionaryIsEmpty?3:-1),t.R7$(),t.vxM(4,null!=r.partsOfSpeech&&r.partsOfSpeech.length&&r.partsOfSpeech.length>1?4:-1),t.R7$(2),t.vxM(6,null!=r.dictionaryTerm&&r.dictionaryTerm.term?6:-1),t.R7$(),t.vxM(7,r.searchTerm.trim().toLowerCase()!==(null==r.dictionaryTerm||null==r.dictionaryTerm.term||null==(p=r.dictionaryTerm.term.trim())?null:p.toLowerCase())?7:-1),t.R7$(2),t.SpI(" ",null==r.dictionaryTerm?null:r.dictionaryTerm.term," "),t.R7$(),t.Dyx(null==r.dictionaryTerm?null:r.dictionaryTerm.articles),t.R7$(2),t.vxM(12,r.words.length?12:-1)}},dependencies:[f.Hl,f.iY,y.m_,y.An,m.YN,m.me,m.BC,v.jL,v.$3,a.wT,v.pN,_.RG,_.rl,_.nJ,g.fS,g.fg,a.Sy,m.X1,m.l_],styles:["[_nghost-%COMP%]{display:block;padding:var(--padding-main);font-size:var(--dictionary-main-font-size)}.parts-of-speech[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.parts-of-speech[_ngcontent-%COMP%]   .part-of-speech[_ngcontent-%COMP%]{cursor:pointer;margin:4px}.parts-of-speech[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{outline:1px solid green}.header[_ngcontent-%COMP%]{font-size:var(--dictionary-header-font-size);font-weight:700;display:flex;flex-wrap:wrap;align-items:center;gap:8px}.header[_ngcontent-%COMP%]   .favorite-word-button[_ngcontent-%COMP%]{padding:8px 0 0;margin-right:-8px}.header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:1}.has-examples[_ngcontent-%COMP%]   .def-text[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]{margin:16px 0}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]{margin:var(--padding-main) 0;line-height:2}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#f9e79f}.article[_ngcontent-%COMP%]   .article-header[_ngcontent-%COMP%]   .dictionary[_ngcontent-%COMP%]{color:#000;margin:4px;padding:4px;background-color:#94ff7d}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]{margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;background-color:wheat;height:12px;width:12px;transform:translateY(-2px)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .non-content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{height:8px;width:8px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .content-mark[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{background-color:green}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .lex-unit[_ngcontent-%COMP%]{font-weight:700;font-size:1.2em;background-color:wheat;color:#000;padding:2px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .level[_ngcontent-%COMP%]{color:green;font-weight:700;background-color:wheat;padding:2px;margin-right:4px}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .synonym[_ngcontent-%COMP%]{color:green;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .antonym[_ngcontent-%COMP%]{color:red;padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:var(--padding-small)}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]{padding-left:var(--padding-small);margin:4px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%]{margin:8px 0}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]{display:flex;align-items:center}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .original[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{cursor:pointer}.article[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .examples[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:gray;padding-left:var(--padding-large)}.part-of-speech[_ngcontent-%COMP%]{font-weight:700;background-color:wheat;color:#000;padding:4px;margin:4px 0;cursor:pointer}.words[_ngcontent-%COMP%]{display:flex;gap:8px}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:center;gap:var(--padding-main);width:100%}.form-field[_ngcontent-%COMP%]{width:800px;max-width:90vw}.mat-label[_ngcontent-%COMP%]{color:gray!important}"],changeDetection:0})}};T=(0,o.Cg)([(0,O.d)()],T)},3609:(S,M,s)=>{s.d(M,{K:()=>v});var o=s(4412),t=s(4572),O=s(6697);function f(_,g){const a=g.index>=0?g.index:_.length+g.index;if(_.slice(a,a+g.pattern.length)!==g.pattern)return null;const l=_.length-(_.slice(0,g.index).length+g.pattern.length);let h=_.slice(0,g.index)+g.replace;return l>0&&(h+=_.slice(-1*l)),h}var y=s(4438),m=s(7915);let v=(()=>{class _{constructor(a){this.bookService=a,this.currentDictionaryState$=new o.t(null),this.minimalSearchPattern=2,this.maxNumberOfSearchResults=50,this.morphology={},this.morphologyReplaceRules=[],this.dictionaryIsEmpty=!0,this.morphologyIsEmpty=!0,this.searchTerm="",this.currentTerm="",this.terms=[],this.seeAlsoWords=[],(0,t.z)([this.bookService.getMorphology$(),this.bookService.getDictionaryTerms$(),this.bookService.getMorphologyReplaceRules$()]).pipe((0,O.s)(1)).subscribe(([l,h,c])=>{l?.morphology?(this.morphology=l.morphology,this.morphologyIsEmpty=!1):(this.morphology={},this.morphologyIsEmpty=!0),this.morphologyReplaceRules=c?.morphologyReplaceRules?c.morphologyReplaceRules:[],h.length?(this.terms=h,this.dictionaryIsEmpty=!1):this.dictionaryIsEmpty=!0,this.setDictionaryState(null),this.searchTerm&&this.setTerm(this.searchTerm)})}searchTerms(a){if(a.length<this.minimalSearchPattern)return null;const l=new RegExp(a.replaceAll("*",".+"),"iu");return this.terms.filter(h=>l.test(h)).slice(0,this.maxNumberOfSearchResults)}setTerm(a){if(this.searchTerm=a,this.currentTerm=a.trim().toLowerCase(),this.seeAlsoWords=[],this.setDictionaryState(null),this.morphologyReplaceRules.forEach(h=>{const c=f(this.currentTerm,h);c&&this.checkTerm(c)&&this.seeAlsoWords.push(c)}),!this.morphologyIsEmpty){const h=this.morphology[this.currentTerm];h?.o&&this.seeAlsoWords.push(h.o)}let l=this.checkTerm(this.currentTerm);if(l)this.setDictionaryState(l);else{if(!this.morphologyIsEmpty){const h=this.morphology[this.currentTerm];if(h?.o&&(l=this.checkTerm(h.o),l))return void this.setDictionaryState(l)}for(let h=0;h<this.morphologyReplaceRules.length;h++){const c=f(this.currentTerm,this.morphologyReplaceRules[h]);if(!c)continue;const d=this.checkTerm(c);if(d)return this.currentTerm=c,void this.setDictionaryState(d)}}}setDictionaryState(a){a?this.bookService.getDictionaryItem$(a).subscribe(l=>{this.currentDictionaryState$.next({currentDictionaryTerm:l,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}):this.setNullState()}setNullState(){this.seeAlsoWords=[],this.currentDictionaryState$.next({currentDictionaryTerm:null,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}checkTerm(a){return this.terms.includes(a)?a:""}static{this.\u0275fac=function(l){return new(l||_)(y.KVO(m.l))}}static{this.\u0275prov=y.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},7251:(S,M,s)=>{s.d(M,{f:()=>_});var o=s(4412),t=s(6697),O=s(7673),f=s(9040),y=s(4438),m=s(9456),v=s(9530);let _=(()=>{class g{constructor(l,h){this.dbService=l,this.infoService=h,this.examples$=new o.t([]),this.sort=(c,d)=>(c.toDoTimestamp||0)-(d.toDoTimestamp||0),this.dbService.getAll(f.Y.FavoriteExamples).pipe((0,t.s)(1)).subscribe(c=>{c.forEach(d=>d.showDetails=!1),c?(c.sort(this.sort),this.examples$.next(c)):this.examples$.next([])})}deleteAll(){return this.dbService.clear(f.Y.FavoriteExamples)}import(l){const h=JSON.parse(l)?.favoriteExamples;if(!h?.length)return console.error("!examples?.length"),this.infoService.error("!examples?.length"),(0,O.of)([]);const c=this.examples$.value.map(u=>u.timestamp);function d(u){return c.includes(u)?d(u+1):u}return h.forEach(u=>{if(!u.timestamp){const D=d(Date.now());c.push(D),u.timestamp=D}}),this.dbService.bulkAdd(f.Y.FavoriteExamples,h).pipe((0,t.s)(1))}addExample(l){const h=Date.now(),c={...l,timestamp:h,showDetails:!1};this.dbService.add(f.Y.FavoriteExamples,c).pipe((0,t.s)(1)).subscribe();const d=[c,...this.examples$.value];this.examples$.next(d),this.infoService.show("added: "+l.original)}update(l){if(!l?.timestamp||!l.toDoTimestamp)return;const h=this.examples$.value,c=h.find(d=>d.timestamp===l.timestamp);c&&(c.toDoTimestamp=l.toDoTimestamp,c.updateTimestamp=Date.now(),this.dbService.update(f.Y.FavoriteExamples,c).pipe((0,t.s)(1)).subscribe(),h.sort(this.sort),this.examples$.next(h))}removeExample(l){if(!l)return;this.dbService.delete(f.Y.FavoriteExamples,l).pipe((0,t.s)(1)).subscribe();const h=this.examples$.value.filter(c=>c.timestamp!==l);this.examples$.next(h)}static{this.\u0275fac=function(h){return new(h||g)(y.KVO(m.MX),y.KVO(v.O))}}static{this.\u0275prov=y.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},16:(S,M,s)=>{s.d(M,{b:()=>a});var o=s(9437),t=s(5558),O=s(8141),f=s(6697),y=s(6354),m=s(4438),v=s(1626),_=s(1502),g=s(9530);let a=(()=>{class l{constructor(c,d,u){this.http=c,this.localStorageService=d,this.info=u,this.ankiHost=this.localStorageService.ankiHost}markCards(c){this.http.post(this.ankiHost,{action:"forgetCards",version:6,params:{cards:c}}).pipe((0,o.W)(d=>{throw this.info.error("There is error with anki-connection"),d}),(0,t.n)(()=>this.http.post(this.ankiHost,{action:"answerCards",version:6,params:{answers:c.map(d=>({cardId:d,ease:1}))}})),(0,O.M)(()=>this.info.show(c.length+" items are selected")),(0,f.s)(1)).subscribe()}addTagForNotes(c,d){this.http.post(this.ankiHost,{action:"addTags",version:6,params:{notes:c,tags:d}}).pipe((0,o.W)(u=>{throw this.info.error("There is error with anki-connection"),u}),(0,O.M)(()=>this.info.show("Tag is added to "+c.length+" items")),(0,f.s)(1)).subscribe()}findCards(c){return this.http.post(this.ankiHost,{action:"findCards",version:6,params:{query:c}}).pipe((0,o.W)(d=>{throw this.info.error("There is error with anki-connection"),d}),(0,O.M)(d=>{d?.error&&this.info.error("Anki findCards error")}),(0,t.n)(d=>this.http.post(this.ankiHost,{action:"cardsInfo",version:6,params:{cards:d.result}}).pipe((0,O.M)(u=>{u?.error&&this.info.error("Anki findCards error")}),(0,y.T)(u=>u.result))))}findNotes(c){return this.http.post(this.ankiHost,{action:"findNotes",version:6,params:{query:c}}).pipe((0,o.W)(d=>{throw this.info.error("There is error with anki-connection"),d}),(0,O.M)(d=>{d?.error&&this.info.error("Anki findNotes error")}),(0,t.n)(d=>this.http.post(this.ankiHost,{action:"notesInfo",version:6,params:{notes:d.result}}).pipe((0,O.M)(u=>{u?.error&&this.info.error("Anki findCards error")}),(0,y.T)(u=>u.result))))}static{this.\u0275fac=function(d){return new(d||l)(m.KVO(v.Qq),m.KVO(_.s),m.KVO(g.O))}}static{this.\u0275prov=m.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},280:(S,M,s)=>{s.d(M,{b:()=>a});var o=s(4412),t=s(5558),O=s(6354),f=s(6697),y=s(7673),m=s(9040),v=s(4438),_=s(9456),g=s(3609);let a=(()=>{class l{constructor(c,d){this.dbService=c,this.dictionaryService=d,this.check$=new o.t(null),this.dictionaryService.currentDictionaryState$.pipe((0,t.n)(u=>this.getWordFromDB(u?.currentDictionaryTerm?.term||""))).subscribe(u=>{this.check$.next(u)})}importWords(c){return this.dbService.bulkAdd(m.Y.FavoriteWords,c.map(d=>({term:d,v:1})))}getAll(){return this.dbService.getAll(m.Y.FavoriteWords).pipe((0,O.T)(c=>c.map(d=>d.term)),(0,f.s)(1))}switchCurrent(){const c=this.check$.value,d=c?.term,u=c?.status;d&&(u?this.remove(d):this.add(d),this.check$.next({term:d,status:!u}))}add(c){this.dbService.add(m.Y.FavoriteWords,{term:c,v:"1"}).pipe((0,f.s)(1)).subscribe()}remove(c){this.dbService.delete(m.Y.FavoriteWords,c).pipe((0,f.s)(1)).subscribe()}deleteAll(){this.dbService.clear(m.Y.FavoriteWords).pipe((0,f.s)(1)).subscribe()}getWordFromDB(c){return c?this.dbService.getByID(m.Y.FavoriteWords,c).pipe((0,O.T)(d=>({term:c,status:!!d}))):(0,y.of)({term:"",status:!1})}static{this.\u0275fac=function(d){return new(d||l)(v.KVO(_.MX),v.KVO(g.K))}}static{this.\u0275prov=v.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},1502:(S,M,s)=>{s.d(M,{s:()=>v});var o=function(_){return _.CurrentPopupMenuTab="CurrentPopupMenuTab",_.CopyToClipboard="CopyToClipboard",_.UseExternalId="UseExternalId",_.ShowDictionary="ShowDictionary",_.HideMarkedHeaders="HideMarkedHeaders",_.ShowTranslationInBook="ShowTranslationInBook",_.AutoTranslateSelected="AutoTranslateSelected",_.ShowTranslatorInDictionaryViewer="ShowTranslatorInDictionaryViewer",_.AudioVoiceURI="AudioVoiceURI",_.AudioVolume="AudioVolume",_.AudioRate="AudioRate",_.AnkiDeck="AnkiDeck",_.AnkiHost="AnkiHost",_.SyncServerUrl="SyncServerUrl",_.SyncServerIsOn="SyncServerIsOn",_.SyncServerInterval="SyncServerInterval",_.SyncUserKey="SyncUserKey",_}(o||{}),t=s(1177),m=s(4438);let v=(()=>{class _{get syncServerIsOn(){return this.getBoolean(o.SyncServerIsOn,!1)}set syncServerIsOn(a){this.setBoolean(o.SyncServerIsOn,a)}get syncServerUrl(){return localStorage.getItem(o.SyncServerUrl)||"http://main-pc:3003"}set syncServerUrl(a){localStorage.setItem(o.SyncServerUrl,a||"")}get syncUserKey(){return localStorage.getItem(o.SyncUserKey)||"test-user-key"}set syncUserKey(a){localStorage.setItem(o.SyncUserKey,a||"")}get syncServerInterval(){return this.getNumber(o.SyncServerInterval,5)}set syncServerInterval(a){this.setNumber(o.SyncServerInterval,0===a?0:a||5)}get ankiHost(){return localStorage.getItem(o.AnkiHost)||t.jk}set ankiHost(a){localStorage.setItem(o.AnkiHost,a||"")}get ankiDeck(){return localStorage.getItem(o.AnkiDeck)||""}set ankiDeck(a){localStorage.setItem(o.AnkiDeck,a||"")}get audioVoiceURI(){return localStorage.getItem(o.AudioVoiceURI)||""}set audioVoiceURI(a){localStorage.setItem(o.AudioVoiceURI,a||"")}get audioVolume(){return this.getNumber(o.AudioVolume,1)}set audioVolume(a){this.setNumber(o.AudioVolume,0===a?0:a||1)}get audioRate(){return this.getNumber(o.AudioRate,1)}set audioRate(a){this.setNumber(o.AudioRate,0===a?0:a||1)}get hideMarkedHeaders(){return this.getBoolean(o.HideMarkedHeaders,!1)}set hideMarkedHeaders(a){this.setBoolean(o.HideMarkedHeaders,a)}get copyToClipboard(){return this.getBoolean(o.CopyToClipboard,!1)}set copyToClipboard(a){this.setBoolean(o.CopyToClipboard,a)}get useExternalId(){return this.getBoolean(o.UseExternalId,!1)}set useExternalId(a){this.setBoolean(o.UseExternalId,a)}get showDictionary(){return this.getBoolean(o.ShowDictionary,!0)}set showDictionary(a){this.setBoolean(o.ShowDictionary,a)}get showTranslationInBook(){return this.getBoolean(o.ShowTranslationInBook,!0)}set showTranslationInBook(a){this.setBoolean(o.ShowTranslationInBook,a)}get currentPopupMenuTab(){return this.getNumber(o.CurrentPopupMenuTab)}set currentPopupMenuTab(a){this.setNumber(o.CurrentPopupMenuTab,a||0)}constructor(){this.trueString="true",this.falseString="false"}getString(a,l=""){return localStorage.getItem(a)||l}setString(a,l){localStorage.setItem(a,l)}setNumber(a,l){localStorage.setItem(a,String(l||0))}getNumber(a,l=0){const h=localStorage.getItem(a);if(null===h)return l;const c=+h;return Number.isNaN(c)?l:c}setBoolean(a,l){localStorage.setItem(a,l?this.trueString:this.falseString)}getBoolean(a,l=!1){const h=localStorage.getItem(a);return h===this.trueString||h!==this.falseString&&l}static{this.\u0275fac=function(l){return new(l||_)}}static{this.\u0275prov=m.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},3716:(S,M,s)=>{s.d(M,{T:()=>O});const t=["\u2018","\u201c"," ",".",",","!","?",":",";","\t","\n","\r","'","`","\u2019",'"',"\\","/","[","]","(",")","{","}","-","\u2014","<",">"];function O(){const f=window.getSelection();if(!f)return"";const y=f.toString().trim();if(y)return y;const m=f.focusOffset,v=f.focusNode?.nodeValue;if(!v)return"";const _=v.split("");let g=function o(f,y,m){let v=y;for(;v--;)if(m(f[v],v,f))return v;return-1}(_,m,l=>t.includes(l));g=-1===g?0:g+1;let a=_.findIndex((l,h)=>t.includes(l)&&h>m);return-1===a&&(a=v.length),v.slice(g,a).trim()}},850:(S,M,s)=>{s.d(M,{$3:()=>Q,jL:()=>tt,pN:()=>W});var o=s(4438),t=s(6600),O=s(177),f=s(3980),y=s(6969),m=s(8617),v=s(6860),_=s(9969),g=s(8359),a=s(1413),l=s(9030),h=s(7786),c=s(7673),d=s(3726),u=s(7336),D=s(6939),w=s(9417),B=s(882),U=s(9172),I=s(5558),A=s(6697),b=s(5964),L=s(6354),j=s(8141),K=s(1986),$=s(8203);const V=["panel"],N=["*"];function X(C,T){if(1&C){const e=o.RV6();o.j41(0,"div",1,0),o.bIt("@panelAnimation.done",function(i){o.eBV(e);const r=o.XpG();return o.Njj(r._animationDone.next(i))}),o.SdG(2),o.k0s()}if(2&C){const e=T.id,n=o.XpG();o.HbH(n._classList),o.AVh("mat-mdc-autocomplete-visible",n.showPanel)("mat-mdc-autocomplete-hidden",!n.showPanel)("mat-primary","primary"===n._color)("mat-accent","accent"===n._color)("mat-warn","warn"===n._color),o.Y8G("id",n.id)("@panelAnimation",n.isOpen?"visible":"hidden"),o.BMQ("aria-label",n.ariaLabel||null)("aria-labelledby",n._getPanelAriaLabelledby(e))}}const H=(0,_.hZ)("panelAnimation",[(0,_.wk)("void, hidden",(0,_.iF)({opacity:0,transform:"scaleY(0.8)"})),(0,_.kY)(":enter, hidden => visible",[(0,_.Os)([(0,_.i0)("0.03s linear",(0,_.iF)({opacity:1})),(0,_.i0)("0.12s cubic-bezier(0, 0, 0.2, 1)",(0,_.iF)({transform:"scaleY(1)"}))])]),(0,_.kY)(":leave, visible => hidden",[(0,_.i0)("0.075s linear",(0,_.iF)({opacity:0}))])]);let G=0;class Y{constructor(T,e){this.source=T,this.option=e}}const k=new o.nKC("mat-autocomplete-default-options",{providedIn:"root",factory:function z(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1}}});let Q=(()=>{class C{get isOpen(){return this._isOpen&&this.showPanel}_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const e of this.options)e._changeDetectorRef.markForCheck()}constructor(e,n,i,r){this._changeDetectorRef=e,this._elementRef=n,this._defaults=i,this._activeOptionChanges=g.yU.EMPTY,this._animationDone=new o.bkB,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new o.bkB,this.opened=new o.bkB,this.closed=new o.bkB,this.optionActivated=new o.bkB,this.id="mat-autocomplete-"+G++,this.inertGroups=r?.SAFARI||!1,this.autoActiveFirstOption=!!i.autoActiveFirstOption,this.autoSelectActiveOption=!!i.autoSelectActiveOption,this.requireSelection=!!i.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new m.Au(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe(),this._animationDone.complete()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const n=new Y(this,e);this.optionSelected.emit(n)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_skipPredicate(){return!1}static{this.\u0275fac=function(n){return new(n||C)(o.rXU(o.gRc),o.rXU(o.aKT),o.rXU(k),o.rXU(v.OD))}}static{this.\u0275cmp=o.VBU({type:C,selectors:[["mat-autocomplete"]],contentQueries:function(n,i,r){if(1&n&&(o.wni(r,t.wT,5),o.wni(r,t.QC,5)),2&n){let p;o.mGM(p=o.lsd())&&(i.options=p),o.mGM(p=o.lsd())&&(i.optionGroups=p)}},viewQuery:function(n,i){if(1&n&&(o.GBs(o.C4Q,7),o.GBs(V,5)),2&n){let r;o.mGM(r=o.lsd())&&(i.template=r.first),o.mGM(r=o.lsd())&&(i.panel=r.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[o.Mj6.None,"aria-label","ariaLabel"],ariaLabelledby:[o.Mj6.None,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[o.Mj6.HasDecoratorInputTransform,"autoActiveFirstOption","autoActiveFirstOption",o.L39],autoSelectActiveOption:[o.Mj6.HasDecoratorInputTransform,"autoSelectActiveOption","autoSelectActiveOption",o.L39],requireSelection:[o.Mj6.HasDecoratorInputTransform,"requireSelection","requireSelection",o.L39],panelWidth:"panelWidth",disableRipple:[o.Mj6.HasDecoratorInputTransform,"disableRipple","disableRipple",o.L39],classList:[o.Mj6.None,"class","classList"],hideSingleSelectionIndicator:[o.Mj6.HasDecoratorInputTransform,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",o.L39]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],standalone:!0,features:[o.Jv_([{provide:t.is,useExisting:C}]),o.GFd,o.aNF],ngContentSelectors:N,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(n,i){1&n&&(o.NAR(),o.DNE(0,X,3,16,"ng-template"))},styles:["div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:static;border-radius:var(--mat-autocomplete-container-shape);box-shadow:var(--mat-autocomplete-container-elevation-shadow);background-color:var(--mat-autocomplete-background-color)}.cdk-high-contrast-active div.mat-mdc-autocomplete-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}mat-autocomplete{display:none}"],encapsulation:2,data:{animation:[H]},changeDetection:0})}}return C})();const J={provide:w.kq,useExisting:(0,o.Rfq)(()=>W),multi:!0},F=new o.nKC("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{const C=(0,o.WQX)(y.hJ);return()=>C.scrollStrategies.reposition()}}),q={provide:F,deps:[y.hJ],useFactory:function Z(C){return()=>C.scrollStrategies.reposition()}};let W=(()=>{class C{constructor(e,n,i,r,p,E,R,x,ot,st,rt){this._element=e,this._overlay=n,this._viewContainerRef=i,this._zone=r,this._changeDetectorRef=p,this._dir=R,this._formField=x,this._document=ot,this._viewportRuler=st,this._defaults=rt,this._componentDestroyed=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=g.yU.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new a.B,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="mat-mdc-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=(0,l.v)(()=>{const P=this.autocomplete?this.autocomplete.options:null;return P?P.changes.pipe((0,U.Z)(P),(0,I.n)(()=>(0,h.h)(...P.map(at=>at.onSelectionChange)))):this._zone.onStable.pipe((0,A.s)(1),(0,I.n)(()=>this.optionSelections))}),this._handlePanelKeydown=P=>{(P.keyCode===u._f&&!(0,u.rp)(P)||P.keyCode===u.i7&&(0,u.rp)(P,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),P.stopPropagation(),P.preventDefault())},this._trackedModal=null,this._scrollStrategy=E}ngAfterViewInit(){const e=this._getWindow();typeof e<"u"&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();typeof e<"u"&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&(0,m.Ae)(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return(0,h.h)(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe((0,b.p)(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe((0,b.p)(()=>this._overlayAttached)):(0,c.of)()).pipe((0,L.T)(e=>e instanceof t.MI?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return(0,h.h)((0,d.R)(this._document,"click"),(0,d.R)(this._document,"auxclick"),(0,d.R)(this._document,"touchend")).pipe((0,b.p)(e=>{const n=(0,v.Fb)(e),i=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,r=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&n!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!i||!i.contains(n))&&(!r||!r.contains(n))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(n)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const n=e.keyCode,i=(0,u.rp)(e);if(n===u._f&&!i&&e.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&n===u.Fm&&this.panelOpen&&!i)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const r=this.autocomplete._keyManager.activeItem,p=n===u.i7||n===u.n6;n===u.wn||p&&!i&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):p&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(p||this.autocomplete._keyManager.activeItem!==r)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let n=e.target,i=n.value;if("number"===n.type&&(i=""==i?null:parseFloat(i)),this._previousValue!==i){if(this._previousValue=i,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(i),i){if(this.panelOpen&&!this.autocomplete.requireSelection){const r=this.autocomplete.options?.find(p=>p.selected);r&&i!==this._getDisplayValue(r.value)&&r.deselect(!1)}}else this._clearPreviousSelectedOption(null,!1);if(this._canOpen()&&this._document.activeElement===e.target){const r=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(r)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_floatLabel(e=!1){this._formField&&"auto"===this._formField.floatLabel&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){const e=this._zone.onStable.pipe((0,A.s)(1)),n=this.autocomplete.options.changes.pipe((0,j.M)(()=>this._positionStrategy.reapplyLastPosition()),(0,K.c)(0));return(0,h.h)(e,n).pipe((0,I.n)(()=>(this._zone.run(()=>{const i=this.panelOpen;this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),i!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit())}),this.panelClosingActions)),(0,A.s)(1)).subscribe(i=>this._setValueAndClose(i))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){const n=this.autocomplete;return n&&n.displayWith?n.displayWith(e):e}_assignOptionValue(e){const n=this._getDisplayValue(e);null==e&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(n??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){const n=this.autocomplete,i=e?e.source:this._pendingAutoselectedOption;i?(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),n._emitSelectEvent(i),this._element.nativeElement.focus()):n.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),n._animationDone?n._animationDone.pipe((0,A.s)(1)).subscribe(()=>this._onChange(null)):this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,n){this.autocomplete?.options?.forEach(i=>{i!==e&&i.selected&&i.deselect(n)})}_openPanelInternal(e=this._element.nativeElement.value){this._attachOverlay(e),this._floatLabel(),this._trackedModal&&(0,m.px)(this._trackedModal,"aria-owns",this.autocomplete.id)}_attachOverlay(e){let n=this._overlayRef;n?(this._positionStrategy.setOrigin(this._getConnectedElement()),n.updateSize({width:this._getPanelWidth()})):(this._portal=new D.VA(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),n=this._overlay.create(this._getOverlayConfig()),this._overlayRef=n,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&n&&n.updateSize({width:this._getPanelWidth()})})),n&&!n.hasAttached()&&(n.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());const i=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&i!==this.panelOpen&&this._emitOpened()}_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){const e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new y.rR({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const n=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],i=this._aboveClass,r=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:i},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:i}];let p;p="above"===this.position?r:"below"===this.position?n:[...n,...r],e.withPositions(p)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;if(e.autoActiveFirstOption){let n=-1;for(let i=0;i<e.options.length;i++)if(!e.options.get(i).disabled){n=i;break}e._keyManager.setActiveItem(n)}else e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){return this._document?.defaultView||window}_scrollToOption(e){const n=this.autocomplete,i=(0,t.jb)(e,n.options,n.optionGroups);if(0===e&&1===i)n._setScrollTop(0);else if(n.panel){const r=n.options.toArray()[e];if(r){const p=r._getHostElement(),E=(0,t.TL)(p.offsetTop,p.offsetHeight,n._getScrollTop(),n.panel.nativeElement.offsetHeight);n._setScrollTop(E)}}}_applyModalPanelOwnership(){const e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;const n=this.autocomplete.id;this._trackedModal&&(0,m.Ae)(this._trackedModal,"aria-owns",n),(0,m.px)(e,"aria-owns",n),this._trackedModal=e}_clearFromModal(){this._trackedModal&&((0,m.Ae)(this._trackedModal,"aria-owns",this.autocomplete.id),this._trackedModal=null)}static{this.\u0275fac=function(n){return new(n||C)(o.rXU(o.aKT),o.rXU(y.hJ),o.rXU(o.c1b),o.rXU(o.SKi),o.rXU(o.gRc),o.rXU(F),o.rXU($.dS,8),o.rXU(B.xb,9),o.rXU(O.qQ,8),o.rXU(f.Xj),o.rXU(k,8))}}static{this.\u0275dir=o.FsC({type:C,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(n,i){1&n&&o.bIt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(p){return i._handleInput(p)})("keydown",function(p){return i._handleKeydown(p)})("click",function(){return i._handleClick()}),2&n&&o.BMQ("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-controls",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[o.Mj6.None,"matAutocomplete","autocomplete"],position:[o.Mj6.None,"matAutocompletePosition","position"],connectedTo:[o.Mj6.None,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[o.Mj6.None,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[o.Mj6.HasDecoratorInputTransform,"matAutocompleteDisabled","autocompleteDisabled",o.L39]},exportAs:["matAutocompleteTrigger"],standalone:!0,features:[o.Jv_([J]),o.GFd,o.OA$]})}}return C})(),tt=(()=>{class C{static{this.\u0275fac=function(n){return new(n||C)}}static{this.\u0275mod=o.$C({type:C})}static{this.\u0275inj=o.G2t({providers:[q],imports:[y.z_,t.Sy,t.yE,O.MD,f.Gj,t.Sy,t.yE]})}}return C})()}}]);