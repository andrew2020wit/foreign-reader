"use strict";(self.webpackChunkforeign_reader=self.webpackChunkforeign_reader||[]).push([[217],{2945:(O,M,o)=>{o.d(M,{KM:()=>f,N3:()=>m,s7:()=>r,wf:()=>T});const r="http://127.0.0.1:8765",f=500,T="ankiTag",m="ankiRequestText"},4861:(O,M,o)=>{o.d(M,{E:()=>n});var r=o(5619),f=o(2572),T=o(8180);function m(s,u){const l=u.index>=0?u.index:s.length+u.index;if(s.slice(l,l+u.pattern.length)!==u.pattern)return null;const d=s.length-(s.slice(0,u.index).length+u.pattern.length);let t=s.slice(0,u.index)+u.replace;return d>0&&(t+=s.slice(-1*d)),t}var c=o(5879),h=o(5071);let n=(()=>{class s{constructor(l){this.bookService=l,this.currentDictionaryState$=new r.X(null),this.minimalSearchPattern=2,this.maxNumberOfSearchResults=50,this.morphology={},this.morphologyReplaceRules=[],this.dictionaryIsEmpty=!0,this.morphologyIsEmpty=!0,this.searchTerm="",this.currentTerm="",this.terms=[],this.seeAlsoWords=[],(0,f.a)([this.bookService.getMorphology$(),this.bookService.getDictionaryTerms$(),this.bookService.getMorphologyReplaceRules$()]).pipe((0,T.q)(1)).subscribe(([d,t,i])=>{d?.morphology?(this.morphology=d.morphology,this.morphologyIsEmpty=!1):(this.morphology={},this.morphologyIsEmpty=!0),this.morphologyReplaceRules=i?.morphologyReplaceRules?i.morphologyReplaceRules:[],t.length?(this.terms=t,this.dictionaryIsEmpty=!1):this.dictionaryIsEmpty=!0,this.setDictionaryState(null),this.searchTerm&&this.setTerm(this.searchTerm)})}searchTerms(l){if(l.length<this.minimalSearchPattern)return null;const d=new RegExp(l.replaceAll("*",".+"),"iu");return this.terms.filter(t=>d.test(t)).slice(0,this.maxNumberOfSearchResults)}setTerm(l){if(this.searchTerm=l,this.currentTerm=l.trim().toLowerCase(),this.seeAlsoWords=[],this.setDictionaryState(null),this.morphologyReplaceRules.forEach(t=>{const i=m(this.currentTerm,t);i&&this.checkTerm(i)&&this.seeAlsoWords.push(i)}),!this.morphologyIsEmpty){const t=this.morphology[this.currentTerm];t?.o&&this.seeAlsoWords.push(t.o)}let d=this.checkTerm(this.currentTerm);if(d)this.setDictionaryState(d);else{if(!this.morphologyIsEmpty){const t=this.morphology[this.currentTerm];if(t?.o&&(d=this.checkTerm(t.o),d))return void this.setDictionaryState(d)}for(let t=0;t<this.morphologyReplaceRules.length;t++){const i=m(this.currentTerm,this.morphologyReplaceRules[t]);if(!i)continue;const g=this.checkTerm(i);if(g)return this.currentTerm=i,void this.setDictionaryState(g)}}}setDictionaryState(l){l?this.bookService.getDictionaryItem$(l).subscribe(d=>{this.currentDictionaryState$.next({currentDictionaryTerm:d,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}):this.setNullState()}setNullState(){this.seeAlsoWords=[],this.currentDictionaryState$.next({currentDictionaryTerm:null,dictionaryIsEmpty:this.dictionaryIsEmpty,searchTerm:this.searchTerm,seeAlsoWords:this.seeAlsoWords})}checkTerm(l){return this.terms.includes(l)?l:""}}return s.\u0275fac=function(l){return new(l||s)(c.LFG(h.Z))},s.\u0275prov=c.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},8495:(O,M,o)=>{o.d(M,{S:()=>l});var r=o(6306),f=o(9397),T=o(8180),m=o(4664),c=o(7398),h=o(5879),n=o(9862),s=o(2969),u=o(957);let l=(()=>{class d{constructor(i,g,p){this.http=i,this.localStorageService=g,this.info=p,this.ankiHost=this.localStorageService.ankiHost}addTagForNotes(i,g){this.http.post(this.ankiHost,{action:"addTags",version:6,params:{notes:i,tags:g}}).pipe((0,r.K)(p=>{throw this.info.error("There is error with anki-connection"),p}),(0,f.b)(()=>this.info.show("Tag added to "+i.length+" items")),(0,T.q)(1)).subscribe()}findNotes(i){return this.http.post(this.ankiHost,{action:"findNotes",version:6,params:{query:i}}).pipe((0,r.K)(g=>{throw this.info.error("There is error with anki-connection"),g}),(0,f.b)(g=>{g?.error&&this.info.error("Anki findNotes error")}),(0,m.w)(g=>this.http.post(this.ankiHost,{action:"notesInfo",version:6,params:{notes:g.result}}).pipe((0,f.b)(p=>{p?.error&&this.info.error("Anki findCards error")}),(0,c.U)(p=>p.result))))}}return d.\u0275fac=function(i){return new(i||d)(h.LFG(n.eN),h.LFG(s.n),h.LFG(u.C))},d.\u0275prov=h.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},217:(O,M,o)=>{o.r(M),o.d(M,{FavoriteWordPageComponent:()=>x});var P,r=o(7582),f=o(1791),T=o(6814),m=o(2296),c=o(617),h=o(9157),n=o(6223),s=o(2032),u=o(8180),l=o(2945),d=o(2058),t=o(5879),i=o(5591),g=o(8495),p=o(957),A=o(2969);function y(v,a){if(1&v){const e=t.EpF();t.TgZ(0,"div",20)(1,"div",21)(2,"button",22),t.NdJ("click",function(){const k=t.CHM(e).$implicit,E=t.oxw();return t.KtG(E.remove(k))}),t.TgZ(3,"mat-icon"),t._uU(4,"star"),t.qZA()()(),t.TgZ(5,"div",23),t.NdJ("click",function(){const k=t.CHM(e).$implicit,E=t.oxw();return t.KtG(E.selectTerm(k))}),t.TgZ(6,"button",24),t._uU(7),t.qZA()()()}if(2&v){const e=a.$implicit;t.xp6(2),t.Q6J("color","accent"),t.xp6(5),t.hij(" ",e," ")}}function I(v,a){if(1&v){const e=t.EpF();t.TgZ(0,"div",25)(1,"button",26),t.NdJ("click",function(){t.CHM(e);const _=t.oxw();return t.KtG(_.deleteAll())}),t._uU(2," Delete All "),t.qZA()()}}function D(v,a){if(1&v){const e=t.EpF();t.TgZ(0,"div",27)(1,"button",13),t.NdJ("click",function(){t.CHM(e);const _=t.oxw();return t.KtG(_.selectAll())}),t._uU(2," Select All "),t.qZA(),t.TgZ(3,"button",13),t.NdJ("click",function(){t.CHM(e);const _=t.oxw();return t.KtG(_.deselectAll())}),t._uU(4," Deselect "),t.qZA(),t.TgZ(5,"button",13),t.NdJ("click",function(){t.CHM(e);const _=t.oxw();return t.KtG(_.addTag())}),t._uU(6," Add tag to selected "),t.qZA()()}if(2&v){const e=t.oxw();t.xp6(1),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("disabled",!e.ankiRequestText)}}function b(v,a){if(1&v&&(t.TgZ(0,"div",33),t._uU(1),t.qZA()),2&v){const e=t.oxw().$implicit;t.xp6(1),t.hij(" tags: ",null==e.tags?null:e.tags.join(" | ")," ")}}function W(v,a){if(1&v){const e=t.EpF();t.TgZ(0,"div",28),t.NdJ("click",function(){const k=t.CHM(e).$implicit;return t.KtG(k.selected=!k.selected)}),t.TgZ(1,"div",29),t._uU(2),t.qZA(),t.TgZ(3,"div",30),t._uU(4),t.qZA(),t.TgZ(5,"div",31),t._uU(6),t.qZA(),t.YNc(7,b,2,1,"div",32),t.qZA()}if(2&v){const e=a.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Q0o(" ",null==e.fields.term?null:e.fields.term.value," (",null==e.fields.pos?null:e.fields.pos.value,") ",null==e.fields.freq?null:e.fields.freq.value," ",null==e.fields.freq2?null:e.fields.freq2.value," [ ",e.modelName," ",null==e.fields.sensenum?null:e.fields.sensenum.value," ",null==e.fields.exampleId?null:e.fields.exampleId.value," ] "),t.xp6(2),t.hij(" ",null==e.fields.exampleText?null:e.fields.exampleText.value," "),t.xp6(2),t.hij(" ",null==e.fields.def?null:e.fields.def.value," "),t.xp6(1),t.Q6J("ngIf",null==e.tags?null:e.tags.length)}}let x=((P=class{constructor(a,e,C,_,k){this.favoriteWordsService=a,this.ankiConnectService=e,this.cdr=C,this.info=_,this.localStorageService=k,this.favoriteWordList=[],this.textForImport="",this.ankiHost=this.localStorageService.ankiHost,this.ankiDeck=this.localStorageService.ankiDeck,this.tag=localStorage.getItem(l.wf)||"selected",this.ankiRequestText=localStorage.getItem(l.N3)||"flag:2",this.ankiResultList=[],this.resultNumber=0,this.maxAnkiResultNumber=l.KM}ngOnInit(){this.favoriteWordsService.getAll().pipe((0,f.t)(this)).subscribe(a=>{this.favoriteWordList=a||[],this.cdr.detectChanges()})}selectAll(){this.ankiResultList.forEach(a=>a.selected=!0),this.cdr.detectChanges()}deselectAll(){this.ankiResultList.forEach(a=>a.selected=!1),this.cdr.detectChanges()}selectTerm(a){let e="";this.ankiDeck&&(e+="deck:"+this.ankiDeck+" "),e+='term:"'+a+'"',this.ankiRequestText=e,this.request()}addTag(){if(!this.tag)return void this.info.error("Wrong tag");const a=this.ankiResultList.filter(e=>e.selected&&!e.tags?.includes(this.tag)).map(e=>e.noteId);a.length?(localStorage.setItem(l.wf,this.tag),this.ankiConnectService.addTagForNotes(a,this.tag)):this.info.error("Nothing to add!")}request(){this.ankiRequestText&&(localStorage.setItem(l.N3,this.ankiRequestText),this.ankiConnectService.findNotes(this.ankiRequestText).pipe((0,u.q)(1)).subscribe(a=>{this.resultNumber=a.length,this.ankiResultList=a.slice(0,l.KM),this.cdr.detectChanges()}))}importText(){const a=this.textForImport.split("\n").map(e=>e.trim()).filter(e=>!this.favoriteWordList.includes(e));this.favoriteWordsService.importWords(a).pipe((0,u.q)(1)).subscribe(),this.textForImport="",this.favoriteWordList=[...this.favoriteWordList,...a],this.cdr.detectChanges()}remove(a){this.favoriteWordsService.remove(a),this.favoriteWordList=this.favoriteWordList.filter(e=>e!==a),this.cdr.detectChanges()}deleteAll(){this.favoriteWordsService.deleteAll(),this.favoriteWordList=[],this.cdr.detectChanges()}}).\u0275fac=function(a){return new(a||P)(t.Y36(i.d),t.Y36(g.S),t.Y36(t.sBO),t.Y36(p.C),t.Y36(A.n))},P.\u0275cmp=t.Xpm({type:P,selectors:[["app-favorite-word-page"]],standalone:!0,features:[t.jDz],decls:33,vars:11,consts:[[1,"top-block"],[1,"favorite-word-list"],["mat-button","","color","primary","routerLink","/"],["class","favorite-word-list-item",4,"ngFor","ngForOf"],["class","remove-button",4,"ngIf"],[1,"anki-connect-block"],[1,"settings"],[1,"anki-result-sum"],["appearance","outline"],["matInput","",1,"flag-input",3,"ngModel","ngModelChange"],[1,"anki-request"],["appearance","outline",1,"request-mat-form-field"],["matInput","",1,"flag-input",3,"ngModel","keydown.enter","ngModelChange"],["mat-button","","color","primary",3,"disabled","click"],["class","buttons",4,"ngIf"],[1,"result-items"],["class","result-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"import-block"],["appearance","outline",1,"description"],["matInput","",1,"import-text-area",3,"ngModel","ngModelChange"],[1,"favorite-word-list-item"],[1,"star"],["mat-icon-button","",1,"favorite-word-button",3,"color","click"],[1,"term",3,"click"],["mat-button","","color","primary",1,"term-button"],[1,"remove-button"],["mat-button","","color","warn",1,"term-button",3,"click"],[1,"buttons"],[1,"result-item",3,"click"],[1,"top"],[1,"example"],[1,"def"],["class","tags",4,"ngIf"],[1,"tags"]],template:function(a,e){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._uU(3," Home "),t.qZA(),t.YNc(4,y,8,2,"div",3),t.YNc(5,I,3,0,"div",4),t.qZA(),t.TgZ(6,"div",5)(7,"div",6)(8,"div",7),t._uU(9),t.qZA(),t.TgZ(10,"mat-form-field",8)(11,"mat-label"),t._uU(12,"Anki tag to add"),t.qZA(),t.TgZ(13,"input",9),t.NdJ("ngModelChange",function(_){return e.tag=_}),t.qZA()()(),t.TgZ(14,"div",10)(15,"mat-form-field",11)(16,"mat-label"),t._uU(17,"Anki request text"),t.qZA(),t.TgZ(18,"input",12),t.NdJ("keydown.enter",function(){return e.request()})("ngModelChange",function(_){return e.ankiRequestText=_}),t.qZA()(),t.TgZ(19,"button",13),t.NdJ("click",function(){return e.request()}),t._uU(20,"Go! "),t.qZA()(),t.YNc(21,D,7,3,"div",14),t.TgZ(22,"div",15),t.YNc(23,W,8,12,"div",16),t.qZA()()(),t.TgZ(24,"h2"),t._uU(25,"Import"),t.qZA(),t.TgZ(26,"div",17)(27,"mat-form-field",18)(28,"mat-label"),t._uU(29,"Words to import"),t.qZA(),t.TgZ(30,"textarea",19),t.NdJ("ngModelChange",function(_){return e.textForImport=_}),t.qZA()(),t.TgZ(31,"button",13),t.NdJ("click",function(){return e.importText()}),t._uU(32,"Import "),t.qZA()()),2&a&&(t.xp6(4),t.Q6J("ngForOf",e.favoriteWordList),t.xp6(1),t.Q6J("ngIf",!!e.favoriteWordList.length&&e.favoriteWordList.length>1),t.xp6(4),t.AsE(" Anki-connect, resultNumber: ",e.resultNumber,", max: ",e.maxAnkiResultNumber," "),t.xp6(4),t.Q6J("ngModel",e.tag),t.xp6(5),t.Q6J("ngModel",e.ankiRequestText),t.xp6(1),t.Q6J("disabled",!e.ankiRequestText),t.xp6(2),t.Q6J("ngIf",null==e.ankiResultList?null:e.ankiResultList.length),t.xp6(2),t.Q6J("ngForOf",e.ankiResultList),t.xp6(7),t.Q6J("ngModel",e.textForImport),t.xp6(1),t.Q6J("disabled",!e.textForImport))},dependencies:[T.ez,T.sg,T.O5,m.ot,m.lW,m.RK,c.Ps,c.Hw,h.lN,h.KE,h.hX,n.u5,n.Fj,n.JJ,n.On,s.c,s.Nt,d.rH],styles:["[_nghost-%COMP%]{display:block;padding:24px}.top-block[_ngcontent-%COMP%]{display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]{flex:1}.anki-connect-block[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:start;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .anki-request[_ngcontent-%COMP%]{width:100%;display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .anki-request[_ngcontent-%COMP%]   .request-mat-form-field[_ngcontent-%COMP%]{flex:1}.anki-connect-block[_ngcontent-%COMP%]   .anki-result-sum[_ngcontent-%COMP%]{color:#00f}.anki-connect-block[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]{border:1px solid lightgray;margin:16px 0;padding:4px 8px;cursor:pointer}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item.selected[_ngcontent-%COMP%]{border:1px solid green}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{color:gray}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%]{margin:8px 0}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .def[_ngcontent-%COMP%]{color:gray}.anki-connect-block[_ngcontent-%COMP%]   .result-items[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{color:green}.favorite-word-list[_ngcontent-%COMP%]   .favorite-word-list-item[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.favorite-word-list[_ngcontent-%COMP%]   .term-button[_ngcontent-%COMP%]{justify-content:start;max-width:200px;min-width:100px;overflow:clip}.import-block[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 100px}.import-block[_ngcontent-%COMP%]   .import-text-area[_ngcontent-%COMP%]{height:400px}"]}),P);x=(0,r.gn)([(0,f.c)()],x)},5591:(O,M,o)=>{o.d(M,{d:()=>l});var r=o(5619),f=o(4664),T=o(7398),m=o(8180),c=o(2096),h=o(7772),n=o(5879),s=o(6280),u=o(4861);let l=(()=>{class d{constructor(i,g){this.dbService=i,this.dictionaryService=g,this.check$=new r.X(null),this.dictionaryService.currentDictionaryState$.pipe((0,f.w)(p=>this.getWordFromDB(p?.currentDictionaryTerm?.term||""))).subscribe(p=>{this.check$.next(p)})}importWords(i){return this.dbService.bulkAdd(h.L.FavoriteWords,i.map(g=>({term:g,v:1})))}getAll(){return this.dbService.getAll(h.L.FavoriteWords).pipe((0,T.U)(i=>i.map(g=>g.term)),(0,m.q)(1))}switchCurrent(){const i=this.check$.value,g=i?.term,p=i?.status;g&&(p?this.remove(g):this.add(g),this.check$.next({term:g,status:!p}))}add(i){this.dbService.add(h.L.FavoriteWords,{term:i,v:"1"}).pipe((0,m.q)(1)).subscribe()}remove(i){this.dbService.delete(h.L.FavoriteWords,i).pipe((0,m.q)(1)).subscribe()}deleteAll(){this.dbService.clear(h.L.FavoriteWords).pipe((0,m.q)(1)).subscribe()}getWordFromDB(i){return i?this.dbService.getByID(h.L.FavoriteWords,i).pipe((0,T.U)(g=>({term:i,status:!!g}))):(0,c.of)({term:"",status:!1})}}return d.\u0275fac=function(i){return new(i||d)(n.LFG(s.ys),n.LFG(u.E))},d.\u0275prov=n.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},2969:(O,M,o)=>{o.d(M,{n:()=>m});var r=function(c){return c.CurrentPopupMenuTab="CurrentPopupMenuTab",c.CopyToClipboard="CopyToClipboard",c.UseExternalId="UseExternalId",c.ShowDictionary="ShowDictionary",c.HideMarkedHeaders="HideMarkedHeaders",c.ShowTranslationInBook="ShowTranslationInBook",c.AutoTranslateSelected="AutoTranslateSelected",c.ShowTranslatorInDictionaryViewer="ShowTranslatorInDictionaryViewer",c.AudioVoiceURI="AudioVoiceURI",c.AudioVolume="AudioVolume",c.AudioRate="AudioRate",c.AnkiDeck="AnkiDeck",c.AnkiHost="AnkiHost",c}(r||{}),f=o(2945),T=o(5879);let m=(()=>{class c{get ankiHost(){return localStorage.getItem(r.AnkiHost)||f.s7}set ankiHost(n){localStorage.setItem(r.AnkiHost,n||"")}get ankiDeck(){return localStorage.getItem(r.AnkiDeck)||""}set ankiDeck(n){localStorage.setItem(r.AnkiDeck,n||"")}get audioVoiceURI(){return localStorage.getItem(r.AudioVoiceURI)||""}set audioVoiceURI(n){localStorage.setItem(r.AudioVoiceURI,n||"")}get audioVolume(){return this.getNumber(r.AudioVolume,1)}set audioVolume(n){this.setNumber(r.AudioVolume,0===n?0:n||1)}get audioRate(){return this.getNumber(r.AudioRate,1)}set audioRate(n){this.setNumber(r.AudioRate,0===n?0:n||1)}get hideMarkedHeaders(){return this.getBoolean(r.HideMarkedHeaders,!1)}set hideMarkedHeaders(n){this.setBoolean(r.HideMarkedHeaders,n)}get copyToClipboard(){return this.getBoolean(r.CopyToClipboard,!1)}set copyToClipboard(n){this.setBoolean(r.CopyToClipboard,n)}get useExternalId(){return this.getBoolean(r.UseExternalId,!1)}set useExternalId(n){this.setBoolean(r.UseExternalId,n)}get showDictionary(){return this.getBoolean(r.ShowDictionary,!0)}set showDictionary(n){this.setBoolean(r.ShowDictionary,n)}get showTranslationInBook(){return this.getBoolean(r.ShowTranslationInBook,!0)}set showTranslationInBook(n){this.setBoolean(r.ShowTranslationInBook,n)}get currentPopupMenuTab(){return this.getNumber(r.CurrentPopupMenuTab)}set currentPopupMenuTab(n){this.setNumber(r.CurrentPopupMenuTab,n||0)}constructor(){this.trueString="true",this.falseString="false"}getString(n,s=""){return localStorage.getItem(n)||s}setString(n,s){localStorage.setItem(n,s)}setNumber(n,s){localStorage.setItem(n,String(s||0))}getNumber(n,s=0){const u=localStorage.getItem(n);if(null===u)return s;const l=+u;return Number.isNaN(l)?s:l}setBoolean(n,s){localStorage.setItem(n,s?this.trueString:this.falseString)}getBoolean(n,s=!1){const u=localStorage.getItem(n);return u===this.trueString||u!==this.falseString&&s}}return c.\u0275fac=function(n){return new(n||c)},c.\u0275prov=T.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);